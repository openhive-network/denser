const e=(e,t)=>t.some((t=>e instanceof t));let t,r;const n=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,i=new WeakMap;let l={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return o.get(e);if("objectStoreNames"===t)return e.objectStoreNames||s.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return d(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function c(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(h(this),t),d(n.get(this))}:function(...t){return d(e.apply(h(this),t))}:function(t,...r){const n=e.call(h(this),t,...r);return s.set(n,t.sort?t.sort():[t]),d(n)}}function u(r){return"function"==typeof r?c(r):(r instanceof IDBTransaction&&function(e){if(o.has(e))return;const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)}));o.set(e,t)}(r),e(r,t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(r,l):r)}function d(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(d(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&n.set(t,e)})).catch((()=>{})),i.set(t,e),t}(e);if(a.has(e))return a.get(e);const t=u(e);return t!==e&&(a.set(e,t),i.set(t,e)),t}const h=e=>i.get(e);function p(e,t,{blocked:r,upgrade:n,blocking:o,terminated:s}={}){const a=indexedDB.open(e,t),i=d(a);return n&&a.addEventListener("upgradeneeded",(e=>{n(d(a.result),e.oldVersion,e.newVersion,d(a.transaction),e)})),r&&a.addEventListener("blocked",(e=>r(e.oldVersion,e.newVersion,e))),i.then((e=>{s&&e.addEventListener("close",(()=>s())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),i}const m=["get","getKey","getAll","getAllKeys","count"],f=["put","add","delete","clear"],w=new Map;function g(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,o=f.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!o&&!m.includes(r))return;const s=async function(e,...t){const s=this.transaction(e,o?"readwrite":"readonly");let a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),o&&s.done]))[0]};return w.set(t,s),s}l=(e=>({...e,get:(t,r,n)=>g(t,r)||e.get(t,r,n),has:(t,r)=>!!g(t,r)||e.has(t,r)}))(l);
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
const y=Symbol("Comlink.proxy"),v=Symbol("Comlink.endpoint"),k=Symbol("Comlink.releaseProxy"),E=Symbol("Comlink.finalizer"),b=Symbol("Comlink.thrown"),_=e=>"object"==typeof e&&null!==e||"function"==typeof e,$=new Map([["proxy",{canHandle:e=>_(e)&&e[y],serialize(e){const{port1:t,port2:r}=new MessageChannel;return S(e,t),[r,[r]]},deserialize(e){return e.start(),F(e,[],t);var t}}],["throw",{canHandle:e=>_(e)&&b in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function S(e,t=globalThis,r=["*"]){t.addEventListener("message",(function n(o){if(!o||!o.data)return;if(!function(e,t){for(const r of e){if(t===r||"*"===r)return!0;if(r instanceof RegExp&&r.test(t))return!0}return!1}(r,o.origin))return void console.warn(`Invalid origin '${o.origin}' for comlink proxy`);const{id:s,type:a,path:i}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(O);let c;try{const t=i.slice(0,-1).reduce(((e,t)=>e[t]),e),r=i.reduce(((e,t)=>e[t]),e);switch(a){case"GET":c=r;break;case"SET":t[i.slice(-1)[0]]=O(o.data.value),c=!0;break;case"APPLY":c=r.apply(t,l);break;case"CONSTRUCT":c=function(e){return Object.assign(e,{[y]:!0})}(new r(...l));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;S(e,r),c=function(e,t){return x.set(e,t),e}(t,[t])}break;case"RELEASE":c=void 0;break;default:return}}catch(e){c={value:e,[b]:0}}Promise.resolve(c).catch((e=>({value:e,[b]:0}))).then((r=>{const[o,i]=W(r);t.postMessage(Object.assign(Object.assign({},o),{id:s}),i),"RELEASE"===a&&(t.removeEventListener("message",n),P(t),E in e&&"function"==typeof e[E]&&e[E]())})).catch((e=>{const[r,n]=W({value:new TypeError("Unserializable return value"),[b]:0});t.postMessage(Object.assign(Object.assign({},r),{id:s}),n)}))})),t.start&&t.start()}function P(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function T(e){if(e)throw new Error("Proxy has been released and is not useable")}function D(e){return B(e,{type:"RELEASE"}).then((()=>{P(e)}))}const A=new WeakMap,C="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(A.get(e)||0)-1;A.set(e,t),0===t&&D(e)}));function F(e,t=[],r=function(){}){let n=!1;const o=new Proxy(r,{get(r,s){if(T(n),s===k)return()=>{!function(e){C&&C.unregister(e)}(o),D(e),n=!0};if("then"===s){if(0===t.length)return{then:()=>o};const r=B(e,{type:"GET",path:t.map((e=>e.toString()))}).then(O);return r.then.bind(r)}return F(e,[...t,s])},set(r,o,s){T(n);const[a,i]=W(s);return B(e,{type:"SET",path:[...t,o].map((e=>e.toString())),value:a},i).then(O)},apply(r,o,s){T(n);const a=t[t.length-1];if(a===v)return B(e,{type:"ENDPOINT"}).then(O);if("bind"===a)return F(e,t.slice(0,-1));const[i,l]=R(s);return B(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:i},l).then(O)},construct(r,o){T(n);const[s,a]=R(o);return B(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:s},a).then(O)}});return function(e,t){const r=(A.get(t)||0)+1;A.set(t,r),C&&C.register(e,t,e)}(o,e),o}function R(e){const t=e.map(W);return[t.map((e=>e[0])),(r=t.map((e=>e[1])),Array.prototype.concat.apply([],r))];var r}const x=new WeakMap;function W(e){for(const[t,r]of $)if(r.canHandle(e)){const[n,o]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},o]}return[{type:"RAW",value:e},x.get(e)||[]]}function O(e){switch(e.type){case"HANDLER":return $.get(e.name).deserialize(e.value);case"RAW":return e.value}}function B(e,t,r){return new Promise((n=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(r){r.data&&r.data.id&&r.data.id===o&&(e.removeEventListener("message",t),n(r.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:o},t),r)}))}class I extends Error{constructor(e){super(e),this.name="BeekeeperError"}}const j=e=>{if(e instanceof Error)return e.message;const t=e&&"object"==typeof e&&"name"in e?e.name:void 0;return"ErrnoError"===t&&"errno"in e?`ErrnoError: #${e.errno}`:"Unknown error"+(t?`: ${t}`:"")},M=(e,t)=>"object"==typeof e&&null!==e&&"stack"in e?Object.assign(t,{stack:e.stack}):t,N=(e,t="Wasm call")=>{try{return e()}catch(e){throw M(e,new I(`Error during ${t}: ${j(e)}`))}};class z{fs;isWebEnvironment;constructor(e,t){this.fs=e,this.isWebEnvironment=t}sync(e=!1){return new Promise(((t,r)=>{N((()=>this.fs.syncfs(e,(e=>{e&&r(e),t(void 0)}))),"filesystem sync")}))}ensureCreateDir(e,t){const r=(t?"/":"")+e.join("/");N((()=>this.fs.analyzePath(r,!1)),`analyzing path: '${r}'`).exists||(e.length>1&&this.ensureCreateDir(e.slice(0,-1),t),N((()=>this.fs.mkdir(r)),`directory creation: '${r}'`))}async init(e){const t=e.startsWith("/");if(this.isWebEnvironment&&!t)throw new I("Storage root directory must be an absolute path in web environment");const r=e.split("/").filter((e=>!!e&&"."!==e));if(0===r.length)throw new I("Storage root directory must not be empty");this.ensureCreateDir(r,t),this.isWebEnvironment&&N((()=>this.fs.mount(this.fs.filesystems.IDBFS,{},e)),"mounting IDBFS"),await this.sync(!0)}}class L{api;session;locked;constructor(e,t,r){this.api=e,this.session=t,this.locked=r}get name(){return this.locked.name}get isTemporary(){return this.locked.isTemporary}lock(){return this.api.extract(N((()=>this.api.api.lock(this.session.token,this.locked.name)),`wallet '${this.locked.name}' locking`)),this.locked.unlocked=void 0,this.locked}async importKey(e){const{public_key:t}=this.api.extract(N((()=>this.api.api.import_key(this.session.token,this.locked.name,e)),`importing key to wallet '${this.locked.name}'`));return await(this.api.fs?.sync()),t}hasMatchingPrivateKey(e){return this.api.extract(N((()=>this.api.api.has_matching_private_key(this.session.token,this.locked.name,e)),`checking for matching key '${e}' in wallet '${this.locked.name}'`)).exists}async removeKey(e){this.api.extract(N((()=>this.api.api.remove_key(this.session.token,this.locked.name,e)),`removing key '${e}' from wallet '${this.locked.name}'`)),await(this.api.fs?.sync())}signDigest(e,t){return t instanceof Uint8Array&&(t=Array.from(t).map((e=>e.toString(16).padStart(2,"0"))).join("")),this.api.extract(N((()=>this.api.api.sign_digest(this.session.token,t,e)),`signing digest with key '${e}' using wallet '${this.locked.name}'`)).signature}getPublicKeys(){return this.api.extract(N((()=>this.api.api.get_public_keys(this.session.token,this.locked.name)),`public keys retrieval from wallet '${this.locked.name}'`)).keys.map((e=>e.public_key))}encryptData(e,t,r,n){let o;return o=N("number"==typeof n?()=>this.api.api.encrypt_data(this.session.token,t,r||t,this.locked.name,e,n):()=>this.api.api.encrypt_data(this.session.token,t,r||t,this.locked.name,e),`data encryption using keys '${t}', '${r}' from wallet '${this.locked.name}'`),this.api.extract(o).encrypted_content}decryptData(e,t,r){return this.api.extract(N((()=>this.api.api.decrypt_data(this.session.token,t,r||t,this.locked.name,e)),`data encryption using key${void 0===r?` '${t}'`:`s '${t}' and '${r}'`} from wallet '${this.locked.name}'`)).decrypted_content}close(){return this.locked.close()}}class U{api;session;name;isTemporary;unlocked=void 0;constructor(e,t,r,n){this.api=e,this.session=t,this.name=r,this.isTemporary=n}unlock(e){return this.api.extract(N((()=>this.api.api.unlock(this.session.token,this.name,e)),`wallet '${this.name}' unlocking`)),this.unlocked=new L(this.api,this.session,this),this.unlocked}close(){return void 0!==this.unlocked&&this.unlocked.lock(),this.session.closeWallet(this.name),this.session}}class K{api;token;constructor(e,t){this.api=e,this.token=t}wallets=new Map;getInfo(){const e=this.api.extract(N((()=>this.api.api.get_info(this.token)),"session info retrieval"));return{now:new Date(`${e.now}Z`),timeoutTime:new Date(`${e.timeout_time}Z`)}}listWallets(){const e=this.api.extract(N((()=>this.api.api.list_wallets(this.token)),"listing wallets")),t=[];for(const r of e.wallets){const e=this.openWallet(r.name);r.unlocked||(e.unlocked=void 0),t.push(e)}return t}hasWallet(e){return this.api.extract(N((()=>this.api.api.has_wallet(this.token,e)),`checking if wallet '${e}' exists`)).exists}async createWallet(e,t,r){if(!1===r&&void 0===this.api.fs)throw new I("Trying to create persistent wallet without a filesystem (consider disabling the 'inMemory' Beekeeper option or setting 'isTemporary' function argument to true).");if(r=void 0===this.api.fs||(r??!1),"string"==typeof t)this.api.extract(N((()=>this.api.api.create(this.token,e,r,t)),`${r?"temporary ":""}wallet '${e}' creation`));else{const r=this.api.extract(N((()=>this.api.api.create(this.token,e)),`wallet '${e} creation'`));({password:t}=r)}await(this.api.fs?.sync());const n=new U(this.api,this,e,r);return n.unlocked=new L(this.api,this,n),this.wallets.set(e,n),{wallet:n.unlocked,password:t}}openWallet(e){if(this.wallets.has(e))return this.wallets.get(e);this.api.extract(N((()=>this.api.api.open(this.token,e)),`wallet '${e}' opening`));const t=new U(this.api,this,e,!1);return this.wallets.set(e,t),t}closeWallet(e){if(!this.wallets.delete(e))throw new I(`This Beekeeper API session is not the owner of wallet identified by name: "${e}"`);this.api.extract(N((()=>this.api.api.close(this.token,e)),`wallet '${e}' closing`))}lockAll(){const e=Array.from(this.wallets.values());for(const t of e)void 0!==t.unlocked&&t.unlocked.lock();return e}close(){for(const e of this.wallets.values())e.close();return this.api.closeSession(this.token),this.api}}class V{provider;options;fs;api;sessions=new Map;constructor(e,t,r){this.provider=e,this.options=t,this.options.inMemory||(this.fs=new z(this.provider.FS,r))}getVersion(){return"1.28.4-rc0"}extract(e){try{const t=JSON.parse(e);if(t.hasOwnProperty("error"))throw new I(`Beekeeper API error: "${String(t.error)}"`);if(!t.hasOwnProperty("result"))throw new I(`Beekeeper response does not have contain the result: "${e}"`);return JSON.parse(t.result)}catch(t){if(!(t instanceof I))throw new I(`${t instanceof Error?t.name:"Unknown error"}: Could not extract the result from the beekeeper response: "${e}"`);throw t}}async init(){await(this.fs?.init(this.options.storageRoot));const e=["--wallet-dir",`${this.options.storageRoot}/.beekeeper`,"--enable-logs",Boolean(this.options.enableLogs).toString(),"--unlock-timeout",String(this.options.unlockTimeout)],t=new this.provider.StringList;e.forEach((e=>{t.push_back(e)})),this.api=new this.provider.beekeeper_api(t),N((()=>t.delete()),"StringList WASM object deletion"),this.extract(N((()=>this.api.init()),"WASM api initialization"))}createSession(e){const{token:t}=this.extract(N((()=>this.api.create_session(e)),"session creation")),r=new K(this,t);return this.sessions.set(t,r),r}closeSession(e){if(!this.sessions.delete(e))throw new I(`This Beekeeper API instance is not the owner of session identified by token: "${e}"`);this.extract(N((()=>this.api.close_session(e)),"session closing"))}async delete(){for(const e of this.sessions.values())e.close();N((()=>this.api.delete()),"WASM api deletion"),await(this.fs?.sync())}}const q={enableLogs:!1,unlockTimeout:900,inMemory:!1},H=async(e,t,r={},n,o={})=>{const s=await(async(e,t="Wasm call")=>{try{return await e()}catch(e){throw M(e,new I(`Error during ${t}: ${j(e)}`))}})((()=>e(r)),"Beekeeper WASM module loading"),a=new V(s,{...q,storageRoot:t,...o},n);return await a.init(),a};async function G(e={}){var t,r=e,n="./this.program",o=(e,t)=>{throw t},s=self.location.href,a="";try{a=new URL(".",s).href}catch{}t=async e=>{var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)};var i,l,c,u,d,h,p,m,f,w,g,y,v,k,E,b=console.log.bind(console),_=console.error.bind(console),$=!1,S=!1;function P(e){r.onAbort?.(e),_(e="Aborted("+e+")"),$=!0,e+=". Build with -sASSERTIONS for more info.",S&&Je();var t=new WebAssembly.RuntimeError(e);throw u?.(t),t}async function T(e,r,n){if(!e)try{var o=fetch(r,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(o,n)}catch(e){_(`wasm streaming compile failed: ${e}`),_("falling back to ArrayBuffer instantiation")}return async function(e,r){try{var n=await async function(e){if(!i)try{var r=await t(e);return new Uint8Array(r)}catch{}return function(e){if(e==E&&i)return new Uint8Array(i);throw"both async and sync fetching of the wasm failed"}(e)}(e);return await WebAssembly.instantiate(n,r)}catch(e){_(`failed to asynchronously prepare wasm: ${e}`),P(e)}}(r,n)}class D{name="ExitStatus";constructor(e){this.message=`Program terminated with exit(${e})`,this.status=e}}var A=e=>{for(;e.length>0;)e.shift()(r)},C=[],F=[],R=!0,x=new TextDecoder,W=(e,t,r,n)=>{var o=t+r;if(n)return o;for(;e[t]&&!(t>=o);)++t;return t},O=(e,t,r)=>{if(!e)return"";var n=W(h,e,t,r);return x.decode(h.subarray(e,n))},B=()=>{var e=f[+re.varargs>>2];return re.varargs+=4,e},I=B,j={isAbs:e=>"/"===e.charAt(0),splitPath:e=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1),normalizeArray:(e,t)=>{for(var r=0,n=e.length-1;n>=0;n--){var o=e[n];"."===o?e.splice(n,1):".."===o?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:e=>{var t=j.isAbs(e),r="/"===e.slice(-1);return(e=j.normalizeArray(e.split("/").filter((e=>!!e)),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:e=>{var t=j.splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.slice(0,-1)),r+n):"."},basename:e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],join:(...e)=>j.normalize(e.join("/")),join2:(e,t)=>j.normalize(e+"/"+t)},M=e=>{(M=e=>crypto.getRandomValues(e))(e)},N={resolve:(...e)=>{for(var t="",r=!1,n=e.length-1;n>=-1&&!r;n--){var o=n>=0?e[n]:te.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");if(!o)return"";t=o+"/"+t,r=j.isAbs(o)}return(r?"/":"")+(t=j.normalizeArray(t.split("/").filter((e=>!!e)),!r).join("/"))||"."},relative:(e,t)=>{function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=N.resolve(e).slice(1),t=N.resolve(t).slice(1);for(var n=r(e.split("/")),o=r(t.split("/")),s=Math.min(n.length,o.length),a=s,i=0;i<s;i++)if(n[i]!==o[i]){a=i;break}var l=[];for(i=a;i<n.length;i++)l.push("..");return(l=l.concat(o.slice(a))).join("/")}},z=(e,t=0,r,n)=>{var o=W(e,t,r,n);return x.decode(e.buffer?e.subarray(t,o):new Uint8Array(e.slice(t,o)))},L=[],U=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++r):t+=3}return t},K=(e,t,r,n)=>{if(!(n>0))return 0;for(var o=r,s=r+n-1,a=0;a<e.length;++a){var i=e.codePointAt(a);if(i<=127){if(r>=s)break;t[r++]=i}else if(i<=2047){if(r+1>=s)break;t[r++]=192|i>>6,t[r++]=128|63&i}else if(i<=65535){if(r+2>=s)break;t[r++]=224|i>>12,t[r++]=128|i>>6&63,t[r++]=128|63&i}else{if(r+3>=s)break;t[r++]=240|i>>18,t[r++]=128|i>>12&63,t[r++]=128|i>>6&63,t[r++]=128|63&i,a++}}return t[r]=0,r-o},V=(e,t,r)=>{var n=U(e)+1,o=new Array(n),s=K(e,o,0,o.length);return o.length=s,o},q={ttys:[],init(){},shutdown(){},register(e,t){q.ttys[e]={input:[],output:[],ops:t},te.registerDevice(e,q.stream_ops)},stream_ops:{open(e){var t=q.ttys[e.node.rdev];if(!t)throw new te.ErrnoError(43);e.tty=t,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,t,r,n,o){if(!e.tty||!e.tty.ops.get_char)throw new te.ErrnoError(60);for(var s=0,a=0;a<n;a++){var i;try{i=e.tty.ops.get_char(e.tty)}catch(e){throw new te.ErrnoError(29)}if(void 0===i&&0===s)throw new te.ErrnoError(6);if(null==i)break;s++,t[r+a]=i}return s&&(e.node.atime=Date.now()),s},write(e,t,r,n,o){if(!e.tty||!e.tty.ops.put_char)throw new te.ErrnoError(60);try{for(var s=0;s<n;s++)e.tty.ops.put_char(e.tty,t[r+s])}catch(e){throw new te.ErrnoError(29)}return n&&(e.node.mtime=e.node.ctime=Date.now()),s}},default_tty_ops:{get_char:e=>(()=>{if(!L.length){var e=null;if(globalThis.window?.prompt&&null!==(e=window.prompt("Input: "))&&(e+="\n"),!e)return null;L=V(e)}return L.shift()})(),put_char(e,t){null===t||10===t?(b(z(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){e.output?.length>0&&(b(z(e.output)),e.output=[])},ioctl_tcgets:e=>({c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),ioctl_tcsets:(e,t,r)=>0,ioctl_tiocgwinsz:e=>[24,80]},default_tty1_ops:{put_char(e,t){null===t||10===t?(_(z(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){e.output?.length>0&&(_(z(e.output)),e.output=[])}}},H=e=>{e=(e=>65536*Math.ceil(e/65536))(e);var t=Ze(65536,e);return t&&((e,t)=>{h.fill(0,e,e+t)})(t,e),t},G={ops_table:null,mount:e=>G.createNode(null,"/",16895,0),createNode(e,t,r,n){if(te.isBlkdev(r)||te.isFIFO(r))throw new te.ErrnoError(63);G.ops_table||={dir:{node:{getattr:G.node_ops.getattr,setattr:G.node_ops.setattr,lookup:G.node_ops.lookup,mknod:G.node_ops.mknod,rename:G.node_ops.rename,unlink:G.node_ops.unlink,rmdir:G.node_ops.rmdir,readdir:G.node_ops.readdir,symlink:G.node_ops.symlink},stream:{llseek:G.stream_ops.llseek}},file:{node:{getattr:G.node_ops.getattr,setattr:G.node_ops.setattr},stream:{llseek:G.stream_ops.llseek,read:G.stream_ops.read,write:G.stream_ops.write,mmap:G.stream_ops.mmap,msync:G.stream_ops.msync}},link:{node:{getattr:G.node_ops.getattr,setattr:G.node_ops.setattr,readlink:G.node_ops.readlink},stream:{}},chrdev:{node:{getattr:G.node_ops.getattr,setattr:G.node_ops.setattr},stream:te.chrdev_stream_ops}};var o=te.createNode(e,t,r,n);return te.isDir(o.mode)?(o.node_ops=G.ops_table.dir.node,o.stream_ops=G.ops_table.dir.stream,o.contents={}):te.isFile(o.mode)?(o.node_ops=G.ops_table.file.node,o.stream_ops=G.ops_table.file.stream,o.usedBytes=0,o.contents=null):te.isLink(o.mode)?(o.node_ops=G.ops_table.link.node,o.stream_ops=G.ops_table.link.stream):te.isChrdev(o.mode)&&(o.node_ops=G.ops_table.chrdev.node,o.stream_ops=G.ops_table.chrdev.stream),o.atime=o.mtime=o.ctime=Date.now(),e&&(e.contents[t]=o,e.atime=e.mtime=e.ctime=o.atime),o},getFileDataAsTypedArray:e=>e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0),expandFileStorage(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var n=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(n.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,t){if(e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr(e){var t={};return t.dev=te.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,te.isDir(e.mode)?t.size=4096:te.isFile(e.mode)?t.size=e.usedBytes:te.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr(e,t){for(const r of["mode","atime","mtime","ctime"])null!=t[r]&&(e[r]=t[r]);void 0!==t.size&&G.resizeFileStorage(e,t.size)},lookup(e,t){throw G.doesNotExistError||(G.doesNotExistError=new te.ErrnoError(44),G.doesNotExistError.stack="<generic error, no stack>"),G.doesNotExistError},mknod:(e,t,r,n)=>G.createNode(e,t,r,n),rename(e,t,r){var n;try{n=te.lookupNode(t,r)}catch(e){}if(n){if(te.isDir(e.mode))for(var o in n.contents)throw new te.ErrnoError(55);te.hashRemoveNode(n)}delete e.parent.contents[e.name],t.contents[r]=e,e.name=r,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.contents[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){var r=te.lookupNode(e,t);for(var n in r.contents)throw new te.ErrnoError(55);delete e.contents[t],e.ctime=e.mtime=Date.now()},readdir:e=>[".","..",...Object.keys(e.contents)],symlink(e,t,r){var n=G.createNode(e,t,41471,0);return n.link=r,n},readlink(e){if(!te.isLink(e.mode))throw new te.ErrnoError(28);return e.link}},stream_ops:{read(e,t,r,n,o){var s=e.node.contents;if(o>=e.node.usedBytes)return 0;var a=Math.min(e.node.usedBytes-o,n);if(a>8&&s.subarray)t.set(s.subarray(o,o+a),r);else for(var i=0;i<a;i++)t[r+i]=s[o+i];return a},write(e,t,r,n,o,s){if(!n)return 0;var a=e.node;if(a.mtime=a.ctime=Date.now(),t.subarray&&(!a.contents||a.contents.subarray)){if(s)return a.contents=t.subarray(r,r+n),a.usedBytes=n,n;if(0===a.usedBytes&&0===o)return a.contents=t.slice(r,r+n),a.usedBytes=n,n;if(o+n<=a.usedBytes)return a.contents.set(t.subarray(r,r+n),o),n}if(G.expandFileStorage(a,o+n),a.contents.subarray&&t.subarray)a.contents.set(t.subarray(r,r+n),o);else for(var i=0;i<n;i++)a.contents[o+i]=t[r+i];return a.usedBytes=Math.max(a.usedBytes,o+n),n},llseek(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&te.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new te.ErrnoError(28);return n},mmap(e,t,r,n,o){if(!te.isFile(e.node.mode))throw new te.ErrnoError(43);var s,a,i=e.node.contents;if(2&o||!i||i.buffer!==d.buffer){if(a=!0,!(s=H(t)))throw new te.ErrnoError(48);i&&((r>0||r+t<i.length)&&(i=i.subarray?i.subarray(r,r+t):Array.prototype.slice.call(i,r,r+t)),d.set(i,s))}else a=!1,s=i.byteOffset;return{ptr:s,allocated:a}},msync:(e,t,r,n,o)=>(G.stream_ops.write(e,t,0,n,r,!1),0)}},X=(e,t)=>{var r=0;return e&&(r|=365),t&&(r|=146),r},Y={dbs:{},indexedDB:()=>indexedDB,DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",queuePersist:e=>{function t(){"again"===e.idbPersistState?r():e.idbPersistState=0}function r(){e.idbPersistState="idb",Y.syncfs(e,!1,t)}e.idbPersistState?"idb"===e.idbPersistState&&(e.idbPersistState="again"):e.idbPersistState=setTimeout(r,0)},mount:e=>{var t=G.mount(e);if(e?.opts?.autoPersist){e.idbPersistState=0;var r=t.node_ops;t.node_ops={...t.node_ops},t.node_ops.mknod=(e,n,o,s)=>{var a=r.mknod(e,n,o,s);return a.node_ops=t.node_ops,a.idbfs_mount=t.mount,a.memfs_stream_ops=a.stream_ops,a.stream_ops={...a.stream_ops},a.stream_ops.write=(e,t,r,n,o,s)=>(e.node.isModified=!0,a.memfs_stream_ops.write(e,t,r,n,o,s)),a.stream_ops.close=e=>{var t=e.node;if(t.isModified&&(Y.queuePersist(t.idbfs_mount),t.isModified=!1),t.memfs_stream_ops.close)return t.memfs_stream_ops.close(e)},Y.queuePersist(t.mount),a},t.node_ops.rmdir=(...e)=>(Y.queuePersist(t.mount),r.rmdir(...e)),t.node_ops.symlink=(...e)=>(Y.queuePersist(t.mount),r.symlink(...e)),t.node_ops.unlink=(...e)=>(Y.queuePersist(t.mount),r.unlink(...e)),t.node_ops.rename=(...e)=>(Y.queuePersist(t.mount),r.rename(...e))}return t},syncfs:(e,t,r)=>{Y.getLocalSet(e,((n,o)=>{if(n)return r(n);Y.getRemoteSet(e,((e,n)=>{if(e)return r(e);var s=t?n:o,a=t?o:n;Y.reconcile(s,a,r)}))}))},quit:()=>{Object.values(Y.dbs).forEach((e=>e.close())),Y.dbs={}},getDB:(e,t)=>{var r,n=Y.dbs[e];if(n)return t(null,n);try{r=Y.indexedDB().open(e,Y.DB_VERSION)}catch(e){return t(e)}if(!r)return t("Unable to connect to IndexedDB");r.onupgradeneeded=e=>{var t,r=e.target.result,n=e.target.transaction;(t=r.objectStoreNames.contains(Y.DB_STORE_NAME)?n.objectStore(Y.DB_STORE_NAME):r.createObjectStore(Y.DB_STORE_NAME)).indexNames.contains("timestamp")||t.createIndex("timestamp","timestamp",{unique:!1})},r.onsuccess=()=>{n=r.result,Y.dbs[e]=n,t(null,n)},r.onerror=e=>{t(e.target.error),e.preventDefault()}},getLocalSet:(e,t)=>{var r={};function n(e){return"."!==e&&".."!==e}function o(e){return t=>j.join2(e,t)}for(var s=te.readdir(e.mountpoint).filter(n).map(o(e.mountpoint));s.length;){var a,i=s.pop();try{a=te.stat(i)}catch(e){return t(e)}te.isDir(a.mode)&&s.push(...te.readdir(i).filter(n).map(o(i))),r[i]={timestamp:a.mtime}}return t(null,{type:"local",entries:r})},getRemoteSet:(e,t)=>{var r={};Y.getDB(e.mountpoint,((e,n)=>{if(e)return t(e);try{var o=n.transaction([Y.DB_STORE_NAME],"readonly");o.onerror=e=>{t(e.target.error),e.preventDefault()},o.objectStore(Y.DB_STORE_NAME).index("timestamp").openKeyCursor().onsuccess=e=>{var o=e.target.result;if(!o)return t(null,{type:"remote",db:n,entries:r});r[o.primaryKey]={timestamp:o.key},o.continue()}}catch(e){return t(e)}}))},loadLocalEntry:(e,t)=>{var r,n;try{n=te.lookupPath(e).node,r=te.stat(e)}catch(e){return t(e)}return te.isDir(r.mode)?t(null,{timestamp:r.mtime,mode:r.mode}):te.isFile(r.mode)?(n.contents=G.getFileDataAsTypedArray(n),t(null,{timestamp:r.mtime,mode:r.mode,contents:n.contents})):t(new Error("node type not supported"))},storeLocalEntry:(e,t,r)=>{try{if(te.isDir(t.mode))te.mkdirTree(e,t.mode);else{if(!te.isFile(t.mode))return r(new Error("node type not supported"));te.writeFile(e,t.contents,{canOwn:!0})}te.chmod(e,t.mode),te.utime(e,t.timestamp,t.timestamp)}catch(e){return r(e)}r(null)},removeLocalEntry:(e,t)=>{try{var r=te.stat(e);te.isDir(r.mode)?te.rmdir(e):te.isFile(r.mode)&&te.unlink(e)}catch(e){return t(e)}t(null)},loadRemoteEntry:(e,t,r)=>{var n=e.get(t);n.onsuccess=e=>r(null,e.target.result),n.onerror=e=>{r(e.target.error),e.preventDefault()}},storeRemoteEntry:(e,t,r,n)=>{try{var o=e.put(r,t)}catch(e){return void n(e)}o.onsuccess=e=>n(),o.onerror=e=>{n(e.target.error),e.preventDefault()}},removeRemoteEntry:(e,t,r)=>{var n=e.delete(t);n.onsuccess=e=>r(),n.onerror=e=>{r(e.target.error),e.preventDefault()}},reconcile:(e,t,r)=>{var n=0,o=[];Object.keys(e.entries).forEach((r=>{var s=e.entries[r],a=t.entries[r];a&&s.timestamp.getTime()==a.timestamp.getTime()||(o.push(r),n++)}));var s=[];if(Object.keys(t.entries).forEach((t=>{e.entries[t]||(s.push(t),n++)})),!n)return r(null);var a=!1,i=("remote"===e.type?e.db:t.db).transaction([Y.DB_STORE_NAME],"readwrite"),l=i.objectStore(Y.DB_STORE_NAME);function c(e){if(e&&!a)return a=!0,r(e)}i.onerror=i.onabort=e=>{c(e.target.error),e.preventDefault()},i.oncomplete=e=>{a||r(null)},o.sort().forEach((e=>{"local"===t.type?Y.loadRemoteEntry(l,e,((t,r)=>{if(t)return c(t);Y.storeLocalEntry(e,r,c)})):Y.loadLocalEntry(e,((t,r)=>{if(t)return c(t);Y.storeRemoteEntry(l,e,r,c)}))})),s.sort().reverse().forEach((e=>{"local"===t.type?Y.removeLocalEntry(e,c):Y.removeRemoteEntry(l,e,c)}))}},Z=0,J=null,Q=[],ee=async(e,n,o,s,a,i,l,c)=>{var u=n?N.resolve(j.join2(e,n)):e;Z++,r.monitorRunDependencies?.(Z);try{var d=o;"string"==typeof o&&(d=await(async e=>{var r=await t(e);return new Uint8Array(r)})(o)),d=await(async(e,t)=>{for(var r of("undefined"!=typeof Browser&&Browser.init(),Q))if(r.canHandle(t))return r.handle(e,t);return e})(d,u),c?.(),i||((...e)=>{te.createDataFile(...e)})(e,n,d,s,a,l)}finally{(()=>{if(Z--,r.monitorRunDependencies?.(Z),0==Z&&J){var e=J;J=null,e()}})()}},te={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class{name="ErrnoError";constructor(e){this.errno=e}},FSStream:class{shared={};get object(){return this.node}set object(e){this.node=e}get isRead(){return 1!=(2097155&this.flags)}get isWrite(){return!!(2097155&this.flags)}get isAppend(){return 1024&this.flags}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(e,t,r,n){e||(e=this),this.parent=e,this.mount=e.mount,this.id=te.nextInode++,this.name=t,this.mode=r,this.rdev=n,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return te.isDir(this.mode)}get isDevice(){return te.isChrdev(this.mode)}},lookupPath(e,t={}){if(!e)throw new te.ErrnoError(44);t.follow_mount??=!0,j.isAbs(e)||(e=te.cwd()+"/"+e);e:for(var r=0;r<40;r++){for(var n=e.split("/").filter((e=>!!e)),o=te.root,s="/",a=0;a<n.length;a++){var i=a===n.length-1;if(i&&t.parent)break;if("."!==n[a])if(".."!==n[a]){s=j.join2(s,n[a]);try{o=te.lookupNode(o,n[a])}catch(e){if(44===e?.errno&&i&&t.noent_okay)return{path:s};throw e}if(!te.isMountpoint(o)||i&&!t.follow_mount||(o=o.mounted.root),te.isLink(o.mode)&&(!i||t.follow)){if(!o.node_ops.readlink)throw new te.ErrnoError(52);var l=o.node_ops.readlink(o);j.isAbs(l)||(l=j.dirname(s)+"/"+l),e=l+"/"+n.slice(a+1).join("/");continue e}}else{if(s=j.dirname(s),te.isRoot(o)){e=s+"/"+n.slice(a+1).join("/"),r--;continue e}o=o.parent}}return{path:s,node:o}}throw new te.ErrnoError(32)},getPath(e){for(var t;;){if(te.isRoot(e)){var r=e.mount.mountpoint;return t?"/"!==r[r.length-1]?`${r}/${t}`:r+t:r}t=t?`${e.name}/${t}`:e.name,e=e.parent}},hashName(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%te.nameTable.length},hashAddNode(e){var t=te.hashName(e.parent.id,e.name);e.name_next=te.nameTable[t],te.nameTable[t]=e},hashRemoveNode(e){var t=te.hashName(e.parent.id,e.name);if(te.nameTable[t]===e)te.nameTable[t]=e.name_next;else for(var r=te.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode(e,t){var r=te.mayLookup(e);if(r)throw new te.ErrnoError(r);for(var n=te.hashName(e.id,t),o=te.nameTable[n];o;o=o.name_next){var s=o.name;if(o.parent.id===e.id&&s===t)return o}return te.lookup(e,t)},createNode(e,t,r,n){var o=new te.FSNode(e,t,r,n);return te.hashAddNode(o),o},destroyNode(e){te.hashRemoveNode(e)},isRoot:e=>e===e.parent,isMountpoint:e=>!!e.mounted,isFile:e=>32768==(61440&e),isDir:e=>16384==(61440&e),isLink:e=>40960==(61440&e),isChrdev:e=>8192==(61440&e),isBlkdev:e=>24576==(61440&e),isFIFO:e=>4096==(61440&e),isSocket:e=>!(49152&~e),flagsToPermissionString(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:(e,t)=>te.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2,mayLookup:e=>te.isDir(e.mode)?te.nodePermissions(e,"x")||(e.node_ops.lookup?0:2):54,mayCreate(e,t){if(!te.isDir(e.mode))return 54;try{return te.lookupNode(e,t),20}catch(e){}return te.nodePermissions(e,"wx")},mayDelete(e,t,r){var n;try{n=te.lookupNode(e,t)}catch(e){return e.errno}var o=te.nodePermissions(e,"wx");if(o)return o;if(r){if(!te.isDir(n.mode))return 54;if(te.isRoot(n)||te.getPath(n)===te.cwd())return 10}else if(te.isDir(n.mode))return 31;return 0},mayOpen:(e,t)=>e?te.isLink(e.mode)?32:te.isDir(e.mode)&&("r"!==te.flagsToPermissionString(t)||576&t)?31:te.nodePermissions(e,te.flagsToPermissionString(t)):44,checkOpExists(e,t){if(!e)throw new te.ErrnoError(t);return e},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=te.MAX_OPEN_FDS;e++)if(!te.streams[e])return e;throw new te.ErrnoError(33)},getStreamChecked(e){var t=te.getStream(e);if(!t)throw new te.ErrnoError(8);return t},getStream:e=>te.streams[e],createStream:(e,t=-1)=>(e=Object.assign(new te.FSStream,e),-1==t&&(t=te.nextfd()),e.fd=t,te.streams[t]=e,e),closeStream(e){te.streams[e]=null},dupStream(e,t=-1){var r=te.createStream(e,t);return r.stream_ops?.dup?.(r),r},doSetAttr(e,t,r){var n=e?.stream_ops.setattr,o=n?e:t;n??=t.node_ops.setattr,te.checkOpExists(n,63),n(o,r)},chrdev_stream_ops:{open(e){var t=te.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open?.(e)},llseek(){throw new te.ErrnoError(70)}},major:e=>e>>8,minor:e=>255&e,makedev:(e,t)=>e<<8|t,registerDevice(e,t){te.devices[e]={stream_ops:t}},getDevice:e=>te.devices[e],getMounts(e){for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push(...n.mounts)}return t},syncfs(e,t){"function"==typeof e&&(t=e,e=!1),te.syncFSRequests++,te.syncFSRequests>1&&_(`warning: ${te.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var r=te.getMounts(te.root.mount),n=0;function o(e){return te.syncFSRequests--,t(e)}function s(e){if(e)return s.errored?void 0:(s.errored=!0,o(e));++n>=r.length&&o(null)}r.forEach((t=>{if(!t.type.syncfs)return s(null);t.type.syncfs(t,e,s)}))},mount(e,t,r){var n,o="/"===r,s=!r;if(o&&te.root)throw new te.ErrnoError(10);if(!o&&!s){var a=te.lookupPath(r,{follow_mount:!1});if(r=a.path,n=a.node,te.isMountpoint(n))throw new te.ErrnoError(10);if(!te.isDir(n.mode))throw new te.ErrnoError(54)}var i={type:e,opts:t,mountpoint:r,mounts:[]},l=e.mount(i);return l.mount=i,i.root=l,o?te.root=l:n&&(n.mounted=i,n.mount&&n.mount.mounts.push(i)),l},unmount(e){var t=te.lookupPath(e,{follow_mount:!1});if(!te.isMountpoint(t.node))throw new te.ErrnoError(28);var r=t.node,n=r.mounted,o=te.getMounts(n);Object.keys(te.nameTable).forEach((e=>{for(var t=te.nameTable[e];t;){var r=t.name_next;o.includes(t.mount)&&te.destroyNode(t),t=r}})),r.mounted=null;var s=r.mount.mounts.indexOf(n);r.mount.mounts.splice(s,1)},lookup:(e,t)=>e.node_ops.lookup(e,t),mknod(e,t,r){var n=te.lookupPath(e,{parent:!0}).node,o=j.basename(e);if(!o)throw new te.ErrnoError(28);if("."===o||".."===o)throw new te.ErrnoError(20);var s=te.mayCreate(n,o);if(s)throw new te.ErrnoError(s);if(!n.node_ops.mknod)throw new te.ErrnoError(63);return n.node_ops.mknod(n,o,t,r)},statfs:e=>te.statfsNode(te.lookupPath(e,{follow:!0}).node),statfsStream:e=>te.statfsNode(e.node),statfsNode(e){var t={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:te.nextInode,ffree:te.nextInode-1,fsid:42,flags:2,namelen:255};return e.node_ops.statfs&&Object.assign(t,e.node_ops.statfs(e.mount.opts.root)),t},create:(e,t=438)=>(t&=4095,t|=32768,te.mknod(e,t,0)),mkdir:(e,t=511)=>(t&=1023,t|=16384,te.mknod(e,t,0)),mkdirTree(e,t){var r=e.split("/"),n="";for(var o of r)if(o){(n||j.isAbs(e))&&(n+="/"),n+=o;try{te.mkdir(n,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:(e,t,r)=>(void 0===r&&(r=t,t=438),t|=8192,te.mknod(e,t,r)),symlink(e,t){if(!N.resolve(e))throw new te.ErrnoError(44);var r=te.lookupPath(t,{parent:!0}).node;if(!r)throw new te.ErrnoError(44);var n=j.basename(t),o=te.mayCreate(r,n);if(o)throw new te.ErrnoError(o);if(!r.node_ops.symlink)throw new te.ErrnoError(63);return r.node_ops.symlink(r,n,e)},rename(e,t){var r,n,o=j.dirname(e),s=j.dirname(t),a=j.basename(e),i=j.basename(t);if(r=te.lookupPath(e,{parent:!0}).node,n=te.lookupPath(t,{parent:!0}).node,!r||!n)throw new te.ErrnoError(44);if(r.mount!==n.mount)throw new te.ErrnoError(75);var l,c=te.lookupNode(r,a),u=N.relative(e,s);if("."!==u.charAt(0))throw new te.ErrnoError(28);if("."!==(u=N.relative(t,o)).charAt(0))throw new te.ErrnoError(55);try{l=te.lookupNode(n,i)}catch(e){}if(c!==l){var d=te.isDir(c.mode),h=te.mayDelete(r,a,d);if(h)throw new te.ErrnoError(h);if(h=l?te.mayDelete(n,i,d):te.mayCreate(n,i))throw new te.ErrnoError(h);if(!r.node_ops.rename)throw new te.ErrnoError(63);if(te.isMountpoint(c)||l&&te.isMountpoint(l))throw new te.ErrnoError(10);if(n!==r&&(h=te.nodePermissions(r,"w")))throw new te.ErrnoError(h);te.hashRemoveNode(c);try{r.node_ops.rename(c,n,i),c.parent=n}catch(e){throw e}finally{te.hashAddNode(c)}}},rmdir(e){var t=te.lookupPath(e,{parent:!0}).node,r=j.basename(e),n=te.lookupNode(t,r),o=te.mayDelete(t,r,!0);if(o)throw new te.ErrnoError(o);if(!t.node_ops.rmdir)throw new te.ErrnoError(63);if(te.isMountpoint(n))throw new te.ErrnoError(10);t.node_ops.rmdir(t,r),te.destroyNode(n)},readdir(e){var t=te.lookupPath(e,{follow:!0}).node;return te.checkOpExists(t.node_ops.readdir,54)(t)},unlink(e){var t=te.lookupPath(e,{parent:!0}).node;if(!t)throw new te.ErrnoError(44);var r=j.basename(e),n=te.lookupNode(t,r),o=te.mayDelete(t,r,!1);if(o)throw new te.ErrnoError(o);if(!t.node_ops.unlink)throw new te.ErrnoError(63);if(te.isMountpoint(n))throw new te.ErrnoError(10);t.node_ops.unlink(t,r),te.destroyNode(n)},readlink(e){var t=te.lookupPath(e).node;if(!t)throw new te.ErrnoError(44);if(!t.node_ops.readlink)throw new te.ErrnoError(28);return t.node_ops.readlink(t)},stat(e,t){var r=te.lookupPath(e,{follow:!t}).node;return te.checkOpExists(r.node_ops.getattr,63)(r)},fstat(e){var t=te.getStreamChecked(e),r=t.node,n=t.stream_ops.getattr,o=n?t:r;return n??=r.node_ops.getattr,te.checkOpExists(n,63),n(o)},lstat:e=>te.stat(e,!0),doChmod(e,t,r,n){te.doSetAttr(e,t,{mode:4095&r|-4096&t.mode,ctime:Date.now(),dontFollow:n})},chmod(e,t,r){var n;n="string"==typeof e?te.lookupPath(e,{follow:!r}).node:e,te.doChmod(null,n,t,r)},lchmod(e,t){te.chmod(e,t,!0)},fchmod(e,t){var r=te.getStreamChecked(e);te.doChmod(r,r.node,t,!1)},doChown(e,t,r){te.doSetAttr(e,t,{timestamp:Date.now(),dontFollow:r})},chown(e,t,r,n){var o;o="string"==typeof e?te.lookupPath(e,{follow:!n}).node:e,te.doChown(null,o,n)},lchown(e,t,r){te.chown(e,t,r,!0)},fchown(e,t,r){var n=te.getStreamChecked(e);te.doChown(n,n.node,!1)},doTruncate(e,t,r){if(te.isDir(t.mode))throw new te.ErrnoError(31);if(!te.isFile(t.mode))throw new te.ErrnoError(28);var n=te.nodePermissions(t,"w");if(n)throw new te.ErrnoError(n);te.doSetAttr(e,t,{size:r,timestamp:Date.now()})},truncate(e,t){if(t<0)throw new te.ErrnoError(28);var r;r="string"==typeof e?te.lookupPath(e,{follow:!0}).node:e,te.doTruncate(null,r,t)},ftruncate(e,t){var r=te.getStreamChecked(e);if(t<0||!(2097155&r.flags))throw new te.ErrnoError(28);te.doTruncate(r,r.node,t)},utime(e,t,r){var n=te.lookupPath(e,{follow:!0}).node;te.checkOpExists(n.node_ops.setattr,63)(n,{atime:t,mtime:r})},open(e,t,n=438){if(""===e)throw new te.ErrnoError(44);var o,s;if(n=64&(t="string"==typeof t?(e=>{var t={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[e];if(void 0===t)throw new Error(`Unknown file open mode: ${e}`);return t})(t):t)?4095&n|32768:0,"object"==typeof e)o=e;else{s=e.endsWith("/");var a=te.lookupPath(e,{follow:!(131072&t),noent_okay:!0});o=a.node,e=a.path}var i=!1;if(64&t)if(o){if(128&t)throw new te.ErrnoError(20)}else{if(s)throw new te.ErrnoError(31);o=te.mknod(e,511|n,0),i=!0}if(!o)throw new te.ErrnoError(44);if(te.isChrdev(o.mode)&&(t&=-513),65536&t&&!te.isDir(o.mode))throw new te.ErrnoError(54);if(!i){var l=te.mayOpen(o,t);if(l)throw new te.ErrnoError(l)}512&t&&!i&&te.truncate(o,0),t&=-131713;var c=te.createStream({node:o,path:te.getPath(o),flags:t,seekable:!0,position:0,stream_ops:o.stream_ops,ungotten:[],error:!1});return c.stream_ops.open&&c.stream_ops.open(c),i&&te.chmod(o,511&n),!r.logReadFiles||1&t||e in te.readFiles||(te.readFiles[e]=1),c},close(e){if(te.isClosed(e))throw new te.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{te.closeStream(e.fd)}e.fd=null},isClosed:e=>null===e.fd,llseek(e,t,r){if(te.isClosed(e))throw new te.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new te.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new te.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read(e,t,r,n,o){if(n<0||o<0)throw new te.ErrnoError(28);if(te.isClosed(e))throw new te.ErrnoError(8);if(1==(2097155&e.flags))throw new te.ErrnoError(8);if(te.isDir(e.node.mode))throw new te.ErrnoError(31);if(!e.stream_ops.read)throw new te.ErrnoError(28);var s=void 0!==o;if(s){if(!e.seekable)throw new te.ErrnoError(70)}else o=e.position;var a=e.stream_ops.read(e,t,r,n,o);return s||(e.position+=a),a},write(e,t,r,n,o,s){if(n<0||o<0)throw new te.ErrnoError(28);if(te.isClosed(e))throw new te.ErrnoError(8);if(!(2097155&e.flags))throw new te.ErrnoError(8);if(te.isDir(e.node.mode))throw new te.ErrnoError(31);if(!e.stream_ops.write)throw new te.ErrnoError(28);e.seekable&&1024&e.flags&&te.llseek(e,0,2);var a=void 0!==o;if(a){if(!e.seekable)throw new te.ErrnoError(70)}else o=e.position;var i=e.stream_ops.write(e,t,r,n,o,s);return a||(e.position+=i),i},mmap(e,t,r,n,o){if(2&n&&!(2&o)&&2!=(2097155&e.flags))throw new te.ErrnoError(2);if(1==(2097155&e.flags))throw new te.ErrnoError(2);if(!e.stream_ops.mmap)throw new te.ErrnoError(43);if(!t)throw new te.ErrnoError(28);return e.stream_ops.mmap(e,t,r,n,o)},msync:(e,t,r,n,o)=>e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,o):0,ioctl(e,t,r){if(!e.stream_ops.ioctl)throw new te.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile(e,t={}){t.flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding&&P(`Invalid encoding type "${t.encoding}"`);var r=te.open(e,t.flags),n=te.stat(e).size,o=new Uint8Array(n);return te.read(r,o,0,n,0),"utf8"===t.encoding&&(o=z(o)),te.close(r),o},writeFile(e,t,r={}){r.flags=r.flags||577;var n=te.open(e,r.flags,r.mode);"string"==typeof t&&(t=new Uint8Array(V(t))),ArrayBuffer.isView(t)?te.write(n,t,0,t.byteLength,void 0,r.canOwn):P("Unsupported data type"),te.close(n)},cwd:()=>te.currentPath,chdir(e){var t=te.lookupPath(e,{follow:!0});if(null===t.node)throw new te.ErrnoError(44);if(!te.isDir(t.node.mode))throw new te.ErrnoError(54);var r=te.nodePermissions(t.node,"x");if(r)throw new te.ErrnoError(r);te.currentPath=t.path},createDefaultDirectories(){te.mkdir("/tmp"),te.mkdir("/home"),te.mkdir("/home/web_user")},createDefaultDevices(){te.mkdir("/dev"),te.registerDevice(te.makedev(1,3),{read:()=>0,write:(e,t,r,n,o)=>n,llseek:()=>0}),te.mkdev("/dev/null",te.makedev(1,3)),q.register(te.makedev(5,0),q.default_tty_ops),q.register(te.makedev(6,0),q.default_tty1_ops),te.mkdev("/dev/tty",te.makedev(5,0)),te.mkdev("/dev/tty1",te.makedev(6,0));var e=new Uint8Array(1024),t=0,r=()=>(0===t&&(M(e),t=e.byteLength),e[--t]);te.createDevice("/dev","random",r),te.createDevice("/dev","urandom",r),te.mkdir("/dev/shm"),te.mkdir("/dev/shm/tmp")},createSpecialDirectories(){te.mkdir("/proc");var e=te.mkdir("/proc/self");te.mkdir("/proc/self/fd"),te.mount({mount(){var t=te.createNode(e,"fd",16895,73);return t.stream_ops={llseek:G.stream_ops.llseek},t.node_ops={lookup(e,t){var r=+t,n=te.getStreamChecked(r),o={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>n.path},id:r+1};return o.parent=o,o},readdir:()=>Array.from(te.streams.entries()).filter((([e,t])=>t)).map((([e,t])=>e.toString()))},t}},{},"/proc/self/fd")},createStandardStreams(e,t,r){e?te.createDevice("/dev","stdin",e):te.symlink("/dev/tty","/dev/stdin"),t?te.createDevice("/dev","stdout",null,t):te.symlink("/dev/tty","/dev/stdout"),r?te.createDevice("/dev","stderr",null,r):te.symlink("/dev/tty1","/dev/stderr"),te.open("/dev/stdin",0),te.open("/dev/stdout",1),te.open("/dev/stderr",1)},staticInit(){te.nameTable=new Array(4096),te.mount(G,{},"/"),te.createDefaultDirectories(),te.createDefaultDevices(),te.createSpecialDirectories(),te.filesystems={MEMFS:G,IDBFS:Y}},init(e,t,n){te.initialized=!0,e??=r.stdin,t??=r.stdout,n??=r.stderr,te.createStandardStreams(e,t,n)},quit(){for(var e of(te.initialized=!1,te.streams))e&&te.close(e)},findObject(e,t){var r=te.analyzePath(e,t);return r.exists?r.object:null},analyzePath(e,t){try{e=(n=te.lookupPath(e,{follow:!t})).path}catch(e){}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var n=te.lookupPath(e,{parent:!0});r.parentExists=!0,r.parentPath=n.path,r.parentObject=n.node,r.name=j.basename(e),n=te.lookupPath(e,{follow:!t}),r.exists=!0,r.path=n.path,r.object=n.node,r.name=n.node.name,r.isRoot="/"===n.path}catch(e){r.error=e.errno}return r},createPath(e,t,r,n){e="string"==typeof e?e:te.getPath(e);for(var o=t.split("/").reverse();o.length;){var s=o.pop();if(s){var a=j.join2(e,s);try{te.mkdir(a)}catch(e){if(20!=e.errno)throw e}e=a}}return a},createFile(e,t,r,n,o){var s=j.join2("string"==typeof e?e:te.getPath(e),t),a=X(n,o);return te.create(s,a)},createDataFile(e,t,r,n,o,s){var a=t;e&&(e="string"==typeof e?e:te.getPath(e),a=t?j.join2(e,t):e);var i=X(n,o),l=te.create(a,i);if(r){if("string"==typeof r){for(var c=new Array(r.length),u=0,d=r.length;u<d;++u)c[u]=r.charCodeAt(u);r=c}te.chmod(l,146|i);var h=te.open(l,577);te.write(h,r,0,r.length,0,s),te.close(h),te.chmod(l,i)}},createDevice(e,t,r,n){var o=j.join2("string"==typeof e?e:te.getPath(e),t),s=X(!!r,!!n);te.createDevice.major??=64;var a=te.makedev(te.createDevice.major++,0);return te.registerDevice(a,{open(e){e.seekable=!1},close(e){n?.buffer?.length&&n(10)},read(e,t,n,o,s){for(var a=0,i=0;i<o;i++){var l;try{l=r()}catch(e){throw new te.ErrnoError(29)}if(void 0===l&&0===a)throw new te.ErrnoError(6);if(null==l)break;a++,t[n+i]=l}return a&&(e.node.atime=Date.now()),a},write(e,t,r,o,s){for(var a=0;a<o;a++)try{n(t[r+a])}catch(e){throw new te.ErrnoError(29)}return o&&(e.node.mtime=e.node.ctime=Date.now()),a}}),te.mkdev(o,s,a)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(globalThis.XMLHttpRequest)P("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");else try{e.contents=(void 0)(e.url)}catch(e){throw new te.ErrnoError(29)}},createLazyFile(e,t,r,n,o){class s{lengthKnown=!1;chunks=[];get(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,r=e/this.chunkSize|0;return this.getter(r)[t]}}setDataGetter(e){this.getter=e}cacheLength(){var e=new XMLHttpRequest;e.open("HEAD",r,!1),e.send(null),e.status>=200&&e.status<300||304===e.status||P("Couldn't load "+r+". Status: "+e.status);var t,n=Number(e.getResponseHeader("Content-length")),o=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,s=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,a=1048576;o||(a=n);var i=this;i.setDataGetter((e=>{var t=e*a,o=(e+1)*a-1;return o=Math.min(o,n-1),void 0===i.chunks[e]&&(i.chunks[e]=((e,t)=>{e>t&&P("invalid range ("+e+", "+t+") or no bytes requested!"),t>n-1&&P("only "+n+" bytes available! programmer error!");var o=new XMLHttpRequest;return o.open("GET",r,!1),n!==a&&o.setRequestHeader("Range","bytes="+e+"-"+t),o.responseType="arraybuffer",o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.send(null),o.status>=200&&o.status<300||304===o.status||P("Couldn't load "+r+". Status: "+o.status),void 0!==o.response?new Uint8Array(o.response||[]):V(o.responseText||"")})(t,o)),void 0===i.chunks[e]&&P("doXHR failed!"),i.chunks[e]})),!s&&n||(a=n=1,n=this.getter(0).length,a=n,b("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=a,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(globalThis.XMLHttpRequest){P("Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc");var a={isDevice:!1,contents:new s}}else a={isDevice:!1,url:r};var i=te.createFile(e,t,a,n,o);a.contents?i.contents=a.contents:a.url&&(i.contents=null,i.url=a.url),Object.defineProperties(i,{usedBytes:{get:function(){return this.contents.length}}});var l={};function c(e,t,r,n,o){var s=e.node.contents;if(o>=s.length)return 0;var a=Math.min(s.length-o,n);if(s.slice)for(var i=0;i<a;i++)t[r+i]=s[o+i];else for(i=0;i<a;i++)t[r+i]=s.get(o+i);return a}return Object.keys(i.stream_ops).forEach((e=>{var t=i.stream_ops[e];l[e]=(...e)=>(te.forceLoadFile(i),t(...e))})),l.read=(e,t,r,n,o)=>(te.forceLoadFile(i),c(e,t,r,n,o)),l.mmap=(e,t,r,n,o)=>{te.forceLoadFile(i);var s=H(t);if(!s)throw new te.ErrnoError(48);return c(e,d,s,t,r),{ptr:s,allocated:!0}},i.stream_ops=l,i}},re={DEFAULT_POLLMASK:5,calculateAt(e,t,r){if(j.isAbs(t))return t;var n;if(n=-100===e?te.cwd():re.getStreamFromFD(e).path,0==t.length){if(!r)throw new te.ErrnoError(44);return n}return n+"/"+t},writeStat(e,t){w[e>>2]=t.dev,w[e+4>>2]=t.mode,w[e+8>>2]=t.nlink,w[e+12>>2]=t.uid,w[e+16>>2]=t.gid,w[e+20>>2]=t.rdev,v[e+24>>3]=BigInt(t.size),f[e+32>>2]=4096,f[e+36>>2]=t.blocks;var r=t.atime.getTime(),n=t.mtime.getTime(),o=t.ctime.getTime();return v[e+40>>3]=BigInt(Math.floor(r/1e3)),w[e+48>>2]=r%1e3*1e3*1e3,v[e+56>>3]=BigInt(Math.floor(n/1e3)),w[e+64>>2]=n%1e3*1e3*1e3,v[e+72>>3]=BigInt(Math.floor(o/1e3)),w[e+80>>2]=o%1e3*1e3*1e3,v[e+88>>3]=BigInt(t.ino),0},writeStatFs(e,t){w[e+4>>2]=t.bsize,w[e+60>>2]=t.bsize,v[e+8>>3]=BigInt(t.blocks),v[e+16>>3]=BigInt(t.bfree),v[e+24>>3]=BigInt(t.bavail),v[e+32>>3]=BigInt(t.files),v[e+40>>3]=BigInt(t.ffree),w[e+48>>2]=t.fsid,w[e+64>>2]=t.flags,w[e+56>>2]=t.namelen},doMsync(e,t,r,n,o){if(!te.isFile(t.node.mode))throw new te.ErrnoError(43);if(2&n)return 0;var s=h.slice(e,e+r);te.msync(t,s,o,r,n)},getStreamFromFD:e=>te.getStreamChecked(e),varargs:void 0,getStr:e=>O(e)},ne=(e,t,r)=>K(e,h,t,r),oe=()=>at,se=e=>{var t=e.getArg(oe(),0);return ot(t)},ae=e=>et(e),ie=e=>(e=>{var t=tt(),r=ae(4),n=ae(4);st(e,r,n);var o,s=w[r>>2],a=w[n>>2],i=O(s);return Xe(s),a&&(o=O(a),Xe(a)),Qe(t),[i,o]})(se(e)),le=e=>{for(var t="";;){var r=h[e++];if(!r)return t;t+=String.fromCharCode(r)}},ce={},ue={},de={},he=class extends Error{constructor(e){super(e),this.name="BindingError"}},pe=e=>{throw new he(e)};function me(e,t,r={}){return function(e,t,r={}){var n=t.name;if(e||pe(`type "${n}" must have a positive integer typeid pointer`),ue.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;pe(`Cannot register type '${n}' twice`)}if(ue[e]=t,delete de[e],ce.hasOwnProperty(e)){var o=ce[e];delete ce[e],o.forEach((e=>e()))}}(e,t,r)}var fe=(e,t,r)=>{switch(t){case 1:return r?e=>d[e]:e=>h[e];case 2:return r?e=>p[e>>1]:e=>m[e>>1];case 4:return r?e=>f[e>>2]:e=>w[e>>2];case 8:return r?e=>v[e>>3]:e=>k[e>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}},we=e=>{pe(e.$$.ptrType.registeredClass.name+" instance already deleted")},ge=!1,ye=e=>{},ve=e=>{e.count.value-=1,0===e.count.value&&(e=>{e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)})(e)},ke=e=>globalThis.FinalizationRegistry?(ge=new FinalizationRegistry((e=>{ve(e.$$)})),ke=e=>{var t=e.$$;if(t.smartPtr){var r={$$:t};ge.register(e,r,e)}return e},ye=e=>ge.unregister(e),ke(e)):(ke=e=>e,e);function Ee(){}var be=(e,t)=>Object.defineProperty(t,"name",{value:e}),_e={},$e=(e,t,r)=>{if(void 0===e[t].overloadTable){var n=e[t];e[t]=function(...n){return e[t].overloadTable.hasOwnProperty(n.length)||pe(`Function '${r}' called with an invalid number of arguments (${n.length}) - expects one of (${e[t].overloadTable})!`),e[t].overloadTable[n.length].apply(this,n)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}};function Se(e,t,r,n,o,s,a,i){this.name=e,this.constructor=t,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=o,this.getActualType=s,this.upcast=a,this.downcast=i,this.pureVirtualFunctions=[]}var Pe=(e,t,r)=>{for(;t!==r;)t.upcast||pe(`Expected null or instance of ${r.name}, got an instance of ${t.name}`),e=t.upcast(e),t=t.baseClass;return e},Te=e=>{if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e};function De(e,t){if(null===t)return this.isReference&&pe(`null is not a valid ${this.name}`),0;t.$$||pe(`Cannot pass "${Te(t)}" as a ${this.name}`),t.$$.ptr||pe(`Cannot pass deleted object as a pointer of type ${this.name}`);var r=t.$$.ptrType.registeredClass;return Pe(t.$$.ptr,r,this.registeredClass)}function Ae(e,t){var r;if(null===t)return this.isReference&&pe(`null is not a valid ${this.name}`),this.isSmartPointer?(r=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,r),r):0;t&&t.$$||pe(`Cannot pass "${Te(t)}" as a ${this.name}`),t.$$.ptr||pe(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&t.$$.ptrType.isConst&&pe(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);var n=t.$$.ptrType.registeredClass;if(r=Pe(t.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&pe("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?r=t.$$.smartPtr:pe(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:r=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)r=t.$$.smartPtr;else{var o=t.clone();r=this.rawShare(r,ht.toHandle((()=>o.delete()))),null!==e&&e.push(this.rawDestructor,r)}break;default:pe("Unsupporting sharing policy")}return r}function Ce(e,t){if(null===t)return this.isReference&&pe(`null is not a valid ${this.name}`),0;t.$$||pe(`Cannot pass "${Te(t)}" as a ${this.name}`),t.$$.ptr||pe(`Cannot pass deleted object as a pointer of type ${this.name}`),t.$$.ptrType.isConst&&pe(`Cannot convert argument of type ${t.$$.ptrType.name} to parameter type ${this.name}`);var r=t.$$.ptrType.registeredClass;return Pe(t.$$.ptr,r,this.registeredClass)}function Fe(e){return this.fromWireType(w[e>>2])}var Re=(e,t,r)=>{if(t===r)return e;if(void 0===r.baseClass)return null;var n=Re(e,t,r.baseClass);return null===n?null:r.downcast(n)},xe={},We=class extends Error{constructor(e){super(e),this.name="InternalError"}},Oe=e=>{throw new We(e)},Be=(e,t)=>(t.ptrType&&t.ptr||Oe("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&Oe("Both smartPtrType and smartPtr must be specified"),t.count={value:1},ke(Object.create(e,{$$:{value:t,writable:!0}})));function Ie(e,t,r,n,o,s,a,i,l,c,u){this.name=e,this.registeredClass=t,this.isReference=r,this.isConst=n,this.isSmartPointer=o,this.pointeeType=s,this.sharingPolicy=a,this.rawGetPointee=i,this.rawConstructor=l,this.rawShare=c,this.rawDestructor=u,o||void 0!==t.baseClass?this.toWireType=Ae:n?(this.toWireType=De,this.destructorFunction=null):(this.toWireType=Ce,this.destructorFunction=null)}var je=(e,t,r=!1)=>{e=le(e);var n,o=(n=t,lt.get(n));return"function"!=typeof o&&pe(`unknown function pointer with signature ${e}: ${t}`),o};class Me extends Error{}var Ne=e=>{var t=Ye(e),r=le(t);return Xe(t),r},ze=(e,t)=>{var r=[],n={};throw t.forEach((function e(t){n[t]||ue[t]||(de[t]?de[t].forEach(e):(r.push(t),n[t]=!0))})),new Me(`${e}: `+r.map(Ne).join([", "]))},Le=(e,t,r)=>{function n(t){var n=r(t);n.length!==e.length&&Oe("Mismatched type converter count");for(var o=0;o<e.length;++o)me(e[o],n[o])}e.forEach((e=>de[e]=t));var o=new Array(t.length),s=[],a=0;t.forEach(((e,t)=>{ue.hasOwnProperty(e)?o[t]=ue[e]:(s.push(e),ce.hasOwnProperty(e)||(ce[e]=[]),ce[e].push((()=>{o[t]=ue[e],++a===s.length&&n(o)})))})),0===s.length&&n(o)},Ue=(e,t)=>{for(var r=[],n=0;n<e;n++)r.push(w[t+4*n>>2]);return r},Ke=e=>{for(;e.length;){var t=e.pop();e.pop()(t)}};function Ve(e){for(var t=1;t<e.length;++t)if(null!==e[t]&&void 0===e[t].destructorFunction)return!0;return!1}function qe(e,t,r,n,o,s){var a=t.length;a<2&&pe("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var i=null!==t[1]&&null!==r,l=Ve(t),c=!t[0].isVoid,u=t[0],d=t[1],h=[e,pe,n,o,Ke,u.fromWireType.bind(u),d?.toWireType.bind(d)],p=2;p<a;++p){var m=t[p];h.push(m.toWireType.bind(m))}if(!l)for(p=i?1:2;p<t.length;++p)null!==t[p].destructorFunction&&h.push(t[p].destructorFunction);let f=function(e,t,r,n){var o=Ve(e),s=e.length-2,a=[],i=["fn"];t&&i.push("thisWired");for(var l=0;l<s;++l)a.push(`arg${l}`),i.push(`arg${l}Wired`);a=a.join(","),i=i.join(",");var c=`return function (${a}) {\n`;o&&(c+="var destructors = [];\n");var u=o?"destructors":"null",d=["humanName","throwBindingError","invoker","fn","runDestructors","fromRetWire","toClassParamWire"];for(t&&(c+=`var thisWired = toClassParamWire(${u}, this);\n`),l=0;l<s;++l){var h=`toArg${l}Wire`;c+=`var arg${l}Wired = ${h}(${u}, arg${l});\n`,d.push(h)}if(c+=(r||n?"var rv = ":"")+`invoker(${i});\n`,o)c+="runDestructors(destructors);\n";else for(l=t?1:2;l<e.length;++l){var p=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==e[l].destructorFunction&&(c+=`${p}_dtor(${p});\n`,d.push(`${p}_dtor`))}return r&&(c+="var ret = fromRetWire(rv);\nreturn ret;\n"),c+="}\n",new Function(d,c)}(t,i,c,s);var w=f(...h);return be(e,w)}var He,Ge,Xe,Ye,Ze,Je,Qe,et,tt,rt,nt,ot,st,at,it,lt,ct=[],ut=[0,1,,1,null,1,!0,1,!1,1],dt=e=>{e>9&&0==--ut[e+1]&&(ut[e]=void 0,ct.push(e))},ht={toValue:e=>(e||pe(`Cannot use deleted val. handle = ${e}`),ut[e]),toHandle:e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const t=ct.pop()||ut.length;return ut[t]=e,ut[t+1]=1,t}}}},pt={name:"emscripten::val",fromWireType:e=>{var t=ht.toValue(e);return dt(e),t},toWireType:(e,t)=>ht.toHandle(t),readValueFromPointer:Fe,destructorFunction:null},mt=(e,t)=>{switch(t){case 4:return function(e){return this.fromWireType(g[e>>2])};case 8:return function(e){return this.fromWireType(y[e>>3])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}},ft=Object.assign({optional:!0},pt),wt=new TextDecoder("utf-16le"),gt=(e,t,r)=>{var n=e>>1,o=W(m,n,t/2,r);return wt.decode(m.subarray(n,o))},yt=(e,t,r)=>{if(r??=2147483647,r<2)return 0;for(var n=t,o=(r-=2)<2*e.length?r/2:e.length,s=0;s<o;++s){var a=e.charCodeAt(s);p[t>>1]=a,t+=2}return p[t>>1]=0,t-n},vt=e=>2*e.length,kt=(e,t,r)=>{for(var n="",o=e>>2,s=0;!(s>=t/4);s++){var a=w[o+s];if(!a&&!r)break;n+=String.fromCodePoint(a)}return n},Et=(e,t,r)=>{if(r??=2147483647,r<4)return 0;for(var n=t,o=n+r-4,s=0;s<e.length;++s){var a=e.codePointAt(s);if(a>65535&&s++,f[t>>2]=a,(t+=4)+4>o)break}return f[t>>2]=0,t-n},bt=e=>{for(var t=0,r=0;r<e.length;++r)e.codePointAt(r)>65535&&r++,t+=4;return t},_t=[],$t=(e,t,r)=>{var n=[],o=e(n,r);return n.length&&(w[t>>2]=ht.toHandle(n)),o},St={},Pt=e=>{var t=St[e];return void 0===t?le(e):t},Tt=e=>e<-9007199254740992||e>9007199254740992?NaN:Number(e),Dt=()=>Date.now(),At={},Ct=()=>{if(!Ct.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.language||"C").replace("-","_")+".UTF-8",_:n||"./this.program"};for(var t in At)void 0===At[t]?delete e[t]:e[t]=At[t];var r=[];for(var t in e)r.push(`${t}=${e[t]}`);Ct.strings=r}return Ct.strings};if(te.createPreloadedFile=(e,t,r,n,o,s,a,i,l,c)=>{ee(e,t,r,n,o,i,l,c).then(s).catch(a)},te.preloadFile=ee,te.staticInit(),(()=>{let e=Ee.prototype;Object.assign(e,{isAliasOf(e){if(!(this instanceof Ee))return!1;if(!(e instanceof Ee))return!1;var t=this.$$.ptrType.registeredClass,r=this.$$.ptr;e.$$=e.$$;for(var n=e.$$.ptrType.registeredClass,o=e.$$.ptr;t.baseClass;)r=t.upcast(r),t=t.baseClass;for(;n.baseClass;)o=n.upcast(o),n=n.baseClass;return t===n&&r===o},clone(){if(this.$$.ptr||we(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=ke(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t},delete(){this.$$.ptr||we(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&pe("Object already scheduled for deletion"),ye(this),ve(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||we(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&pe("Object already scheduled for deletion"),this.$$.deleteScheduled=!0,this}});const t=Symbol.dispose;t&&(e[t]=e.delete)})(),Object.assign(Ie.prototype,{getPointee(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e},destructor(e){this.rawDestructor?.(e)},readValueFromPointer:Fe,fromWireType:function(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var r=((e,t)=>(t=((e,t)=>{for(void 0===t&&pe("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t})(e,t),xe[t]))(this.registeredClass,t);if(void 0!==r){if(0===r.$$.count.value)return r.$$.ptr=t,r.$$.smartPtr=e,r.clone();var n=r.clone();return this.destructor(e),n}function o(){return this.isSmartPointer?Be(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Be(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var s,a=this.registeredClass.getActualType(t),i=_e[a];if(!i)return o.call(this);s=this.isConst?i.constPointerType:i.pointerType;var l=Re(t,this.registeredClass,s.registeredClass);return null===l?o.call(this):this.isSmartPointer?Be(s.registeredClass.instancePrototype,{ptrType:s,ptr:l,smartPtrType:this,smartPtr:e}):Be(s.registeredClass.instancePrototype,{ptrType:s,ptr:l})}}),r.noExitRuntime&&(R=r.noExitRuntime),r.preloadPlugins&&(Q=r.preloadPlugins),r.print&&(b=r.print),r.printErr&&(_=r.printErr),r.wasmBinary&&(i=r.wasmBinary),r.arguments&&r.arguments,r.thisProgram&&(n=r.thisProgram),r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.shift()();r.FS=te,r.getExceptionMessage=ie,r.incrementExceptionRefcount=e=>{var t=se(e);nt(t)},r.decrementExceptionRefcount=e=>{var t=se(e);rt(t)};var Ft,Rt={j:(e,t,r,n)=>P(`Assertion failed: ${O(e)}, at: `+[t?O(t):"unknown filename",r,n?O(n):"unknown function"]),c:function(e,t,r){re.varargs=r;try{var n=re.getStreamFromFD(e);switch(t){case 0:if((o=B())<0)return-28;for(;te.streams[o];)o++;return te.dupStream(n,o).fd;case 1:case 2:case 13:case 14:return 0;case 3:return n.flags;case 4:var o=B();return n.flags|=o,0;case 12:return o=I(),p[o+0>>1]=2,0}return-28}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},Q:function(e,t){try{return re.writeStat(t,te.fstat(e))}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},P:function(e,t){try{if(0===t)return-28;var r=te.cwd(),n=U(r)+1;return t<n?-68:(ne(r,e,t),n)}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},O:function(e,t,r){try{var n=re.getStreamFromFD(e);n.getdents||=te.readdir(n.path);for(var o=0,s=te.llseek(n,0,1),a=Math.floor(s/280),i=Math.min(n.getdents.length,a+Math.floor(r/280)),l=a;l<i;l++){var c,u,h=n.getdents[l];if("."===h)c=n.node.id,u=4;else if(".."===h)c=te.lookupPath(n.path,{parent:!0}).node.id,u=4;else{var m;try{m=te.lookupNode(n.node,h)}catch(e){if(28===e?.errno)continue;throw e}c=m.id,u=te.isChrdev(m.mode)?2:te.isDir(m.mode)?4:te.isLink(m.mode)?10:8}v[t+o>>3]=BigInt(c),v[t+o+8>>3]=BigInt(280*(l+1)),p[t+o+16>>1]=280,d[t+o+18]=u,ne(h,t+o+19,256),o+=280}return te.llseek(n,280*l,0),o}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},i:function(e,t,r){re.varargs=r;try{var n=re.getStreamFromFD(e);switch(t){case 21509:case 21510:case 21511:case 21512:case 21524:case 21515:return n.tty?0:-59;case 21505:if(!n.tty)return-59;if(n.tty.ops.ioctl_tcgets){var o=n.tty.ops.ioctl_tcgets(n),s=I();f[s>>2]=o.c_iflag||0,f[s+4>>2]=o.c_oflag||0,f[s+8>>2]=o.c_cflag||0,f[s+12>>2]=o.c_lflag||0;for(var a=0;a<32;a++)d[s+a+17]=o.c_cc[a]||0;return 0}return 0;case 21506:case 21507:case 21508:if(!n.tty)return-59;if(n.tty.ops.ioctl_tcsets){s=I();var i=f[s>>2],l=f[s+4>>2],c=f[s+8>>2],u=f[s+12>>2],h=[];for(a=0;a<32;a++)h.push(d[s+a+17]);return n.tty.ops.ioctl_tcsets(n.tty,t,{c_iflag:i,c_oflag:l,c_cflag:c,c_lflag:u,c_cc:h})}return 0;case 21519:return n.tty?(s=I(),f[s>>2]=0,0):-59;case 21520:return n.tty?-28:-59;case 21537:case 21531:return s=I(),te.ioctl(n,t,s);case 21523:if(!n.tty)return-59;if(n.tty.ops.ioctl_tiocgwinsz){var m=n.tty.ops.ioctl_tiocgwinsz(n.tty);s=I(),p[s>>1]=m[0],p[s+2>>1]=m[1]}return 0;default:return-28}}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},N:function(e,t){try{return e=re.getStr(e),re.writeStat(t,te.lstat(e))}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},M:function(e,t,r){try{return t=re.getStr(t),t=re.calculateAt(e,t),te.mkdir(t,r,0),0}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},L:function(e,t,r,n){try{t=re.getStr(t);var o=256&n,s=4096&n;return n&=-6401,t=re.calculateAt(e,t,s),re.writeStat(r,o?te.lstat(t):te.stat(t))}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},h:function(e,t,r,n){re.varargs=n;try{t=re.getStr(t),t=re.calculateAt(e,t);var o=n?B():0;return te.open(t,r,o).fd}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},K:function(e,t){try{return e=re.getStr(e),re.writeStat(t,te.stat(e))}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},g:e=>{var t=new WebAssembly.Exception(oe(),[e],{traceStack:!0});throw t.message=ie(t),t},D:()=>P(""),o:(e,t,r,n,o)=>{t=le(t);const s=0n===n;let a=e=>e;if(s){const e=8*r;a=t=>BigInt.asUintN(e,t),o=a(o)}me(e,{name:t,fromWireType:a,toWireType:(e,t)=>("number"==typeof t&&(t=BigInt(t)),t),readValueFromPointer:fe(t,r,!s),destructorFunction:null})},C:(e,t,r,n)=>{me(e,{name:t=le(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:n},readValueFromPointer:function(e){return this.fromWireType(h[e])},destructorFunction:null})},n:(e,t,n,o,s,a,i,l,c,u,d,h,p)=>{d=le(d),a=je(s,a),l&&=je(i,l),u&&=je(c,u),p=je(h,p);var m=(e=>{var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?`_${e}`:e})(d);((e,t,n)=>{r.hasOwnProperty(e)?(pe(`Cannot register public name '${e}' twice`),$e(r,e,e),r[e].overloadTable.hasOwnProperty(n)&&pe("Cannot register multiple overloads of a function with the same number of arguments (undefined)!"),r[e].overloadTable[void 0]=t):(r[e]=t,r[e].argCount=n)})(m,(function(){ze(`Cannot construct ${d} due to unbound types`,[o])})),Le([e,t,n],o?[o]:[],(t=>{var n,s;t=t[0],s=o?(n=t.registeredClass).instancePrototype:Ee.prototype;var i=be(d,(function(...e){if(Object.getPrototypeOf(this)!==c)throw new he(`Use 'new' to construct ${d}`);if(void 0===h.constructor_body)throw new he(`${d} has no accessible constructor`);var t=h.constructor_body[e.length];if(void 0===t)throw new he(`Tried to invoke ctor of ${d} with invalid number of parameters (${e.length}) - expected (${Object.keys(h.constructor_body).toString()}) parameters instead!`);return t.apply(this,e)})),c=Object.create(s,{constructor:{value:i}});i.prototype=c;var h=new Se(d,i,c,p,n,a,l,u);h.baseClass&&(h.baseClass.__derivedClasses??=[],h.baseClass.__derivedClasses.push(h));var f=new Ie(d,h,!0,!1,!1),w=new Ie(d+"*",h,!1,!1,!1),g=new Ie(d+" const*",h,!1,!0,!1);return _e[e]={pointerType:w,constPointerType:g},((e,t,n)=>{r.hasOwnProperty(e)||Oe("Replacing nonexistent public symbol"),r[e].overloadTable,r[e]=t,r[e].argCount=n})(m,i),[f,w,g]}))},m:(e,t,r,n,o,s)=>{var a=Ue(t,r);o=je(n,o),Le([],[e],(e=>{var r=`constructor ${(e=e[0]).name}`;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new he(`Cannot register multiple constructors with identical number of parameters (${t-1}) for class '${e.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return e.registeredClass.constructor_body[t-1]=()=>{ze(`Cannot construct ${e.name} due to unbound types`,a)},Le([],a,(n=>(n.splice(1,0,null),e.registeredClass.constructor_body[t-1]=qe(r,n,null,o,s),[]))),[]}))},b:(e,t,r,n,o,s,a,i,l,c)=>{var u=Ue(r,n);t=(e=>{const t=(e=e.trim()).indexOf("(");return-1===t?e:e.slice(0,t)})(t=le(t)),s=je(o,s,l),Le([],[e],(e=>{var n=`${(e=e[0]).name}.${t}`;function o(){ze(`Cannot call ${n} due to unbound types`,u)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),i&&e.registeredClass.pureVirtualFunctions.push(t);var c=e.registeredClass.instancePrototype,d=c[t];return void 0===d||void 0===d.overloadTable&&d.className!==e.name&&d.argCount===r-2?(o.argCount=r-2,o.className=e.name,c[t]=o):($e(c,t,n),c[t].overloadTable[r-2]=o),Le([],u,(o=>{var i=qe(n,o,e,s,a,l);return void 0===c[t].overloadTable?(i.argCount=r-2,c[t]=i):c[t].overloadTable[r-2]=i,[]})),[]}))},B:e=>me(e,pt),l:(e,t,r)=>{me(e,{name:t=le(t),fromWireType:e=>e,toWireType:(e,t)=>t,readValueFromPointer:mt(t,r),destructorFunction:null})},d:(e,t,r,n,o)=>{t=le(t);let s=e=>e;if(0===n){var a=32-8*r;s=e=>e<<a>>>a,o=s(o)}me(e,{name:t,fromWireType:s,toWireType:(e,t)=>t,readValueFromPointer:fe(t,r,0!==n),destructorFunction:null})},a:(e,t,r)=>{var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];function o(e){var t=w[e>>2],r=w[e+4>>2];return new n(d.buffer,r,t)}me(e,{name:r=le(r),fromWireType:o,readValueFromPointer:o},{ignoreDuplicateRegistrations:!0})},A:(e,t)=>{me(e,ft)},z:(e,t)=>{me(e,{name:t=le(t),fromWireType(e){var t,r=w[e>>2];return t=O(e+4,r,!0),Xe(e),t},toWireType(e,t){var r;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n="string"==typeof t;n||ArrayBuffer.isView(t)&&1==t.BYTES_PER_ELEMENT||pe("Cannot pass non-string to std::string"),r=n?U(t):t.length;var o=He(4+r+1),s=o+4;return w[o>>2]=r,n?ne(t,s,r+1):h.set(t,s),null!==e&&e.push(Xe,o),o},readValueFromPointer:Fe,destructorFunction(e){Xe(e)}})},f:(e,t,r)=>{var n,o,s;r=le(r),2===t?(n=gt,o=yt,s=vt):(n=kt,o=Et,s=bt),me(e,{name:r,fromWireType:e=>{var r=w[e>>2],o=n(e+4,r*t,!0);return Xe(e),o},toWireType:(e,n)=>{"string"!=typeof n&&pe(`Cannot pass non-string to C++ string type ${r}`);var a=s(n),i=He(4+a+t);return w[i>>2]=a/t,o(n,i+4,a+t),null!==e&&e.push(Xe,i),i},readValueFromPointer:Fe,destructorFunction(e){Xe(e)}})},y:(e,t)=>{me(e,{isVoid:!0,name:t=le(t),fromWireType:()=>{},toWireType:(e,t)=>{}})},x:(e,t,r)=>{var[n,...o]=((e,t)=>{for(var r,n,o,s=new Array(e),a=0;a<e;++a)s[a]=(r=w[t+4*a>>2],n=`parameter ${a}`,void 0,void 0===(o=ue[r])&&pe(`${n} has unknown type ${Ne(r)}`),o);return s})(e,t),s=n.toWireType.bind(n),a=o.map((e=>e.readValueFromPointer.bind(e)));e--;var i,l={toValue:ht.toValue},c=a.map(((e,t)=>{var r=`argFromPtr${t}`;return l[r]=e,`${r}(args${t?"+"+8*t:""})`}));switch(r){case 0:i="toValue(handle)";break;case 2:i="new (toValue(handle))";break;case 3:i="";break;case 1:l.getStringOrSymbol=Pt,i="toValue(handle)[getStringOrSymbol(methodName)]"}i+=`(${c})`,n.isVoid||(l.toReturnWire=s,l.emval_returnValue=$t,i=`return emval_returnValue(toReturnWire, destructorsRef, ${i})`),i=`return function (handle, methodName, destructorsRef, args) {\n  ${i}\n  }`;var u,d,h=new Function(Object.keys(l),i)(...Object.values(l)),p=`methodCaller<(${o.map((e=>e.name))}) => ${n.name}>`;return u=be(p,h),d=_t.length,_t.push(u),d},w:dt,v:(e,t,r,n,o)=>_t[e](t,r,n,o),u:e=>{var t=ht.toValue(e);Ke(t),dt(e)},t:function(e,t,r,n,o,s){s=Tt(s);try{var a=re.getStreamFromFD(o);2&r&&re.doMsync(e,a,t,n,s)}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return-e.errno}},s:(e,t,r,n)=>{var o=(new Date).getFullYear(),s=new Date(o,0,1),a=new Date(o,6,1),i=s.getTimezoneOffset(),l=a.getTimezoneOffset(),c=Math.max(i,l);w[e>>2]=60*c,f[t>>2]=Number(i!=l);var u=e=>{var t=e>=0?"-":"+",r=Math.abs(e);return`UTC${t}${String(Math.floor(r/60)).padStart(2,"0")}${String(r%60).padStart(2,"0")}`},d=u(i),h=u(l);l<i?(ne(d,r,17),ne(h,n,17)):(ne(d,n,17),ne(h,r,17))},J:function(e,t,r){if(!((n=e)>=0&&n<=3))return 28;var n,o;o=0===e?Dt():performance.now();var s=Math.round(1e3*o*1e3);return v[r>>3]=BigInt(s),0},k:Dt,r:e=>{h.length,P("OOM")},I:(e,t)=>{var r=0,n=0;for(var o of Ct()){var s=t+r;w[e+n>>2]=s,r+=ne(o,s,1/0)+1,n+=4}return 0},H:(e,t)=>{var r=Ct();w[e>>2]=r.length;var n=0;for(var o of r)n+=U(o)+1;return w[t>>2]=n,0},e:function(e){try{var t=re.getStreamFromFD(e);return te.close(t),0}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return e.errno}},G:function(e,t){try{var r=re.getStreamFromFD(e),n=r.tty?2:te.isDir(r.mode)?3:te.isLink(r.mode)?7:4;return d[t]=n,p[t+2>>1]=0,v[t+8>>3]=BigInt(0),v[t+16>>3]=BigInt(0),0}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return e.errno}},q:function(e,t,r,n){try{var o=((e,t,r,n)=>{for(var o=0,s=0;s<r;s++){var a=w[t>>2],i=w[t+4>>2];t+=8;var l=te.read(e,d,a,i,n);if(l<0)return-1;if(o+=l,l<i)break;void 0!==n&&(n+=l)}return o})(re.getStreamFromFD(e),t,r);return w[n>>2]=o,0}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return e.errno}},F:function(e,t,r,n){t=Tt(t);try{if(isNaN(t))return 61;var o=re.getStreamFromFD(e);return te.llseek(o,t,r),v[n>>3]=BigInt(o.position),o.getdents&&0===t&&0===r&&(o.getdents=null),0}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return e.errno}},p:function(e,t,r,n){try{var o=((e,t,r,n)=>{for(var o=0,s=0;s<r;s++){var a=w[t>>2],i=w[t+4>>2];t+=8;var l=te.write(e,d,a,i,n);if(l<0)return-1;if(o+=l,l<i)break;void 0!==n&&(n+=l)}return o})(re.getStreamFromFD(e),t,r);return w[n>>2]=o,0}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return e.errno}},E:function(e,t){try{return M(h.subarray(e,e+t)),0}catch(e){if(void 0===te||"ErrnoError"!==e.name)throw e;return e.errno}}};function xt(){var e,t,n=Ge;try{var s=n(0,0);return l=e=s,l=t=e,R||(r.onExit?.(t),$=!0),o(0,new D(t)),s}catch(e){return(e=>{if(e instanceof D||"unwind"==e)return l;o(0,e)})(e)}}return Ft=await async function(){function e(e,t){return function(e){He=e.U,Ge=r._main=e.V,Xe=e.X,Ye=e.Y,Ze=e.Z,Je=e._,Qe=e.$,et=e.aa,tt=e.ba,rt=e.ca,nt=e.da,ot=e.ea,st=e.fa,it=e.R,lt=e.T,at=e.W}(Ft=e.exports),n=it.buffer,d=new Int8Array(n),p=new Int16Array(n),h=new Uint8Array(n),m=new Uint16Array(n),f=new Int32Array(n),w=new Uint32Array(n),g=new Float32Array(n),y=new Float64Array(n),v=new BigInt64Array(n),k=new BigUint64Array(n),Ft;var n}var t,n={a:Rt};return r.instantiateWasm?new Promise(((t,o)=>{r.instantiateWasm(n,((r,n)=>{t(e(r))}))})):(E??=r.locateFile?(t="beekeeper_wasm.common.wasm",r.locateFile?r.locateFile(t,a):a+t):new URL(new URL("assets/beekeeper_wasm.common-Cj9LqpnB.wasm",self.location.href).href,self.location.href).href,e((await T(i,E,n)).instance))}(),function e(){function t(){r.calledRun=!0,$||(S=!0,r.noFSInit||te.initialized||te.init(),Ft.S(),te.ignorePermissions=!1,c?.(r),r.onRuntimeInitialized?.(),r.noInitialRun||xt(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),C.push(e);var e;A(C)}())}Z>0?J=e:(function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),F.push(e);var e;A(F)}(),Z>0?J=e:r.setStatus?(r.setStatus("Running..."),setTimeout((()=>{setTimeout((()=>r.setStatus("")),1),t()}),1)):t())}(),S?r:new Promise(((e,t)=>{c=e,u=t}))}const X=async e=>{const{wasmLocation:t,...r}=e||{};return H(G,"/storage_root",await(async e=>{if(import.meta.client||!import.meta.client&&"object"==typeof import.meta.env&&!import.meta.env?.SSR){const t=e??(await import("./build/beekeeper_wasm.common.wasm?url")).default;return{locateFile:(e,r)=>"beekeeper_wasm.common.wasm"===e?t:r+e}}if("undefined"==typeof window&&"object"==typeof process)return{locateFile:(e,t)=>t+e};const t=e??new URL(new URL("assets/beekeeper_wasm.common-Cj9LqpnB.wasm",self.location.href).href,self.location.href).href;let r;if(t.startsWith("data:application/wasm;base64,")){const e=t.slice(29),n=atob(e),o=n.length,s=new Uint8Array(o);for(let e=0;e<o;++e)s[e]=n.charCodeAt(e);r=s}return{locateFile:(e,r)=>"beekeeper_wasm.common.wasm"===e?t:r+e,wasmBinary:r}})(t),!0,r)};class Y extends Error{constructor(e){super(e),this.description=e,Object.setPrototypeOf(this,Y.prototype)}}class Z extends Error{constructor(e){super(e),this.message=e,this.name="AuthorizationError"}}class J extends Error{constructor(e){super(e),this.message=e,this.name="InternalError"}}var Q,ee,te=Object.defineProperty,re=e=>{throw TypeError(e)},ne=(e,t,r)=>((e,t,r)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r),oe=(e,t,r)=>t.has(e)||re("Cannot "+r),se=(e,t,r)=>(oe(e,t,"read from private field"),r?r.call(e):t.get(e)),ae=(e,t,r)=>t.has(e)?re("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),ie=(e,t,r,n)=>(oe(e,t,"write to private field"),t.set(e,r),r);const le="v3",ce=["active","posting","owner"],ue=async()=>{};class de{constructor(e){this.sessionTimeout=e,ne(this,"Ready"),ne(this,"api"),ne(this,"session"),ne(this,"storage",`/storage_root_${le}`),ne(this,"aliasStorage",`/aliases_${le}`),ne(this,"sessionEndCallback",ue),ne(this,"_generator"),ne(this,"_intervals",{}),ne(this,"settingsStorage",`/settings_${le}`),ae(this,Q,{}),this.Ready=new Promise(((e,t)=>{this.initializeBeekeeperApp().then((()=>{e(this)})).catch(t)}))}async initializeBeekeeperApp(){this.api=await X({enableLogs:true,storageRoot:this.storage,unlockTimeout:this.sessionTimeout}),this.session=this.api.createSession(self.crypto.randomUUID());const e=await this.getWallets();for(const t of e)t.unlocked&&this.startSessionInterval(t.name)}setSessionEndCallback(e=ue){this.sessionEndCallback=e}isValidSession(){const{now:e,timeoutTime:t}=this.session.getInfo();return new Date(e).getTime()<new Date(t).getTime()}startSessionInterval(e){this._intervals[e]&&this.clearSessionInterval(e),this._intervals[e]=setInterval((async()=>{if(!this.isValidSession()){const t=await this.getWallet(e);t?.unlocked?.lock(),se(this,Q)[e]&&(se(this,Q)[e].unlocked=!1,se(this,Q)[e].authorized=!1),this.clearSessionInterval(e)}}),2e3)}clearSessionInterval(e){this._intervals[e]&&(clearInterval(this._intervals[e]),this._intervals=Object.fromEntries(Object.entries(this._intervals).filter((([t])=>t!==e))))}clearAllSessionIntervals(){Object.keys(this._intervals).forEach((e=>{this.clearSessionInterval(e)}))}async onAuthComplete(e,t){t?await this._generator.throw(new Z("Invalid credentials")):(se(this,Q)[e]&&(se(this,Q)[e].authorized=!0),this.startSessionInterval(e),await(this._generator?.next()))}async*processNewRegistration(e,t,r,n,o,s){try{const a=`${e}_temp_${Date.now()}`,i=await this.session.createWallet(a,t,!0),l=await i.wallet.importKey(n),c=i.wallet.signDigest(l,r);await i.wallet.removeKey(l),i.wallet.close(),yield await Promise.resolve(c),yield await this.saveUser(e,t,n,o,s)}catch(e){throw e instanceof Z?new Z(e.message):String(e).includes("key")?new Z("Invalid key or key format"):new Z(e)}}async registerUser(e,t,r,n,o,s=!0){if(!(e&&t&&n&&o))throw new Z("Empty field");return this.checkKeyType(o),this._generator=this.processNewRegistration(e,t,r,n,o,s),(await this._generator.next()).value}async saveUser(e,t,r,n,o=!0){const s=await this.getWallet(e);if(s)if(s?.unlocked)await this.importKey(s.unlocked,r,n);else{const e=s.unlock(t);await this.importKey(e,r,n)}else{const{wallet:o}=await this.session.createWallet(e,t);await this.importKey(o,r,n)}return se(this,Q)[e]||(se(this,Q)[e]={username:e,authorized:!0,unlocked:!0,loggedInKeyType:n,registeredKeyTypes:await this.getRegisteredKeyTypes(e)}),await this.setUserSettings(e,{strict:o},n),"success"}async authenticate(e,t,r,n){const o=await this.getWallet(e);if(!o)throw new Z("Invalid credentials");const s=await this.getAuthByUser(e);s?.authorized&&await this.logout(e);try{const s=o.unlock(t),a=s.getPublicKeys(),i=await this.getAlias(`${e}@${r}`);if(!i)throw s.lock(),new Z("Not authorized, missing authority");if(!a.find((e=>e===i.pubKey)))throw s.lock(),new Z("Not authorized, missing authority");const l=await this.getRegisteredKeyTypes(e);return se(this,Q)[e]={username:e,authorized:!0,unlocked:!0,loggedInKeyType:r,registeredKeyTypes:l},this.startSessionInterval(e),this.sign(e,n,r)}catch(e){if(e instanceof Z)throw e;throw new Z("Invalid credentials")}}async invalidateExistingKey(e,t){try{const r=await this.getRegisteredKeyTypes(e);if(!r?.includes(t))return Promise.resolve();const n=await this.getAlias(`${e}@${t}`);if(n?.alias){const r=`${e}@${t}-${Date.now()}`;await this.addAlias(r,n.pubKey,t),await this.removeAlias(n.alias)}return Promise.resolve()}catch(e){throw e instanceof Z?e:new J(e)}}async importKey(e,t,r){this.checkKeyType(r);try{const n=await this.getAlias(`${e.name}@${r}`);if(n?.alias)throw new Z(`This user is already registered with '${r}' authority`);const o=await e.importKey(t);return await this.addAlias(e.name,o,r),o}catch(e){throw e instanceof Z?e:new J(e)}}async importKeyForUser(e,t,r){const n=await this.getWallet(e);if(n?.unlocked)return await this.importKey(n?.unlocked,t,r);throw new Z("User is not logged in. Please login for importing key")}async getWallet(e){return(await this.getWallets()).find((t=>t.name===e))}async getWallets(){return this.session.listWallets()}async getAuthByUser(e){const t=se(this,Q)[e];return t?(t.registeredKeyTypes=await this.getRegisteredKeyTypes(e),t):null}async getAuths(){try{const e=[];for await(const{name:t}of await this.getWallets()){const r=await this.getAuthByUser(t);r&&e.push(r)}return e}catch(e){throw new Y(`Internal error: \n${e}`)}}async getRegisteredUsers(){const e=await this.getWallets(),t=[];for(const r of e){const e=await this.getRegisteredKeyTypes(r.name);t.push({username:r.name,unlocked:!!r.unlocked,authorized:!!se(this,Q)[r.name]?.authorized,loggedInKeyType:se(this,Q)[r.name]?.loggedInKeyType,registeredKeyTypes:e})}return t}async getRegisteredUserByUsername(e){return(await this.getRegisteredUsers()).find((t=>t.username===e))??null}async singleSign(e,t,r,n){this.checkKeyType(n);try{const n=Date.now(),o=`${e}_temp_${n}`,s=`${e}_${t}_${n}`,a=await this.session.createWallet(o,s,!0),i=await a.wallet.importKey(r),l=a.wallet.signDigest(i,t);return await a.wallet.removeKey(i),a.wallet.close(),l}catch(e){throw new J(e)}}async sign(e,t,r){const n=await this.getWallet(e);if(!n?.unlocked)throw new Z("Not authorized");const o=n.unlocked.getPublicKeys(),s=await this.getAlias(`${e}@${r}`),a=o.find((e=>e===s?.pubKey));if(!a)throw n.unlocked?.lock(),new Z("Not authorized, missing authority");const i=await this.getUserSettings(e),l=i?.strict[r]??!0,c=se(this,Q)[e];if(l&&!c?.authorized)throw new Z("Not authorized");return n.unlocked.signDigest(a,t)}async logout(e){const t=await this.getWallet(e);t?.unlocked?.lock(),ie(this,Q,Object.fromEntries(Object.entries(se(this,Q)).filter((([t])=>t!==e)))),this.clearSessionInterval(e),await this.sessionEndCallback()}async logoutAll(){const e=await this.getWallets();for(const t of e)t.unlocked?.lock();ie(this,Q,{}),this.clearAllSessionIntervals(),await this.sessionEndCallback()}async lock(){try{const e=Object.values(se(this,Q)).filter((e=>e.unlocked));if(0===e.length)throw new Z("There is no existing user session or session already expired");for(const t of e){const e=await this.getWallet(t.username);e?.unlocked?.lock(),se(this,Q)[t.username].unlocked=!1}}catch(e){throw e instanceof Z?e:new J(e)}}async unlock(e,t){try{const r=await this.getWallet(e);if(!se(this,Q)[e]?.authorized)throw new Z("There is no existing user session or session already expired");if(!r)throw new Z("User not found");r.unlocked||(r.unlock(t),se(this,Q)[e].unlocked=!0)}catch(e){throw e instanceof Z?e:String(e).toLowerCase().includes("invalid password")?new Z("Invalid credentials"):new J(e)}}async unregister(e,t){try{await this.api.delete(),await this.removeAlias(`${e}@${t}`),ie(this,Q,Object.fromEntries(Object.entries(se(this,Q)).filter((([t])=>t!==e)))),this.clearSessionInterval(e)}catch(e){throw new J(e)}}async addAlias(e,t,r){const n=await this.getAliasDb(),o=n.transaction(["aliases"],"readwrite"),s=o.objectStore("aliases");await s.add({pubKey:t,alias:`${e}@${r}`}),await o.done,n.close()}async getAlias(e){const t=await this.getAliasDb();return await t.get("aliases",e)}async getRegisteredKeyTypes(e){const t=await this.getAliasDb(),r=await t.getAllKeys("aliases"),n=[];return r.forEach((t=>{const[r,o]=t.split("@");r===e&&n.push(o)})),n}async removeAlias(e){const t=await this.getAliasDb(),r=t.transaction(["aliases"],"readwrite"),n=r.objectStore("aliases");await n.delete(e),await r.done,t.close()}async getAliasDb(){return await p(this.aliasStorage,1,{upgrade(e){if(!e.objectStoreNames.contains("aliases")){e.createObjectStore("aliases",{keyPath:"alias"}).createIndex("alias","alias",{unique:!0})}}})}checkKeyType(e){if(!ce.includes(e))throw new Z("Invalid key type. Only 'active' or 'posting' key supported")}async getUserSettings(e,t){try{const r=await p(this.settingsStorage,1,{upgrade(e){e.createObjectStore("settings")}}),n=await r.get("settings",e);return t?n?{strict:{[t]:n.strict[t]},alias:n.alias}:null:n||null}catch(e){throw new J(e)}}async setUserSettings(e,t,r){try{const n=await p(this.settingsStorage,1,{upgrade(e){e.createObjectStore("settings")}}),o=await n.get("settings",e)||{strict:{},alias:e,authorizedAccounts:{}},s={...o,strict:{...o.strict,[r]:t.strict},authorizedAccounts:{...o.authorizedAccounts,...t.authorizedAccounts}};await n.put("settings",s,e)}catch(e){throw new J(e)}}}Q=new WeakMap;const he=class e{constructor(e){this.sessionTimeout=e}async getWorker(){try{return void 0!==se(e,ee)||ie(e,ee,await new de(this.sessionTimeout).Ready),se(e,ee)}catch(e){throw new J(e)}}async register(e,t,r,n,o,s=!0){return await(await this.getWorker()).registerUser(e,t,r,n,o,s)}async onAuthComplete(e,t){await(await this.getWorker()).onAuthComplete(e,t)}async unregister(e,t){await(await this.getWorker()).unregister(e,t)}async lock(){await(await this.getWorker()).lock()}async unlock(e,t){await(await this.getWorker()).unlock(e,t)}async invalidateExistingKey(e,t){await(await this.getWorker()).invalidateExistingKey(e,t)}async importKey(e,t,r){return await(await this.getWorker()).importKeyForUser(e,t,r)}async authenticate(e,t,r,n){return await(await this.getWorker()).authenticate(e,t,r,n)}async logout(t){await(await this.getWorker()).logout(t),ie(e,ee,void 0)}async logoutAll(){await(await this.getWorker()).logoutAll(),ie(e,ee,void 0)}async setSessionEndCallback(e=ue){(await this.getWorker()).setSessionEndCallback(e)}async getRegisteredUsers(){return await(await this.getWorker()).getRegisteredUsers()}async getRegisteredUserByUsername(e){return await(await this.getWorker()).getRegisteredUserByUsername(e)}async sign(e,t,r){return await(await this.getWorker()).sign(e,t,r)}async singleSign(e,t,r,n){return await(await this.getWorker()).singleSign(e,t,r,n)}async getAuthByUser(e){return await(await this.getWorker()).getAuthByUser(e)}async getAuths(){return await(await this.getWorker()).getAuths()}async getUserSettings(e,t){return await(await this.getWorker()).getUserSettings(e,t)}async setUserSettings(e,t,r){await(await this.getWorker()).setUserSettings(e,t,r)}};ee=new WeakMap,ae(he,ee);const pe={Auth:he};"undefined"!=typeof SharedWorkerGlobalScope&&self instanceof SharedWorkerGlobalScope?onconnect=e=>{const t=e.ports[0];S(pe,t)}:S(pe);export{de as AuthWorker};
